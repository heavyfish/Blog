<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/heavyfish.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/heavyfish.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/heavyfish.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/heavyfish.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/heavyfish.github.io/css/main.css">


<link rel="stylesheet" href="/heavyfish.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"heavyfish.github.io","root":"/heavyfish.github.io/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="速查笔记">
<meta property="og:url" content="https://heavyfish.github.io/page/2/index.html">
<meta property="og:site_name" content="速查笔记">
<meta property="og:locale">
<meta property="article:author" content="Shenxr">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://heavyfish.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>速查笔记</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/heavyfish.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">速查笔记</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/heavyfish.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/heavyfish.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/11/02/k8s/Kubernetes%20in%20Action%20%E7%AC%94%E8%AE%B08%EF%BD%9E9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/11/02/k8s/Kubernetes%20in%20Action%20%E7%AC%94%E8%AE%B08%EF%BD%9E9/" class="post-title-link" itemprop="url">Kubernetes in Action 8～9</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-02 01:11:13" itemprop="dateCreated datePublished" datetime="2020-11-02T01:11:13+08:00">2020-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 22:49:28" itemprop="dateModified" datetime="2021-01-14T22:49:28+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="8、从应用访问pod元数据以及其他资源"><a href="#8、从应用访问pod元数据以及其他资源" class="headerlink" title="8、从应用访问pod元数据以及其他资源"></a>8、从应用访问pod元数据以及其他资源</h1><h2 id="8-1、通过Downward-API传递元数据"><a href="#8-1、通过Downward-API传递元数据" class="headerlink" title="8.1、通过Downward API传递元数据"></a>8.1、通过Downward API传递元数据</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102094945657.png" alt="image-20201102094945657" style="zoom:50%;" />

<h3 id="8-1-1、了解可用的元数据"><a href="#8-1-1、了解可用的元数据" class="headerlink" title="8.1.1、了解可用的元数据"></a>8.1.1、了解可用的元数据</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095020431.png" alt="image-20201102095020431" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095046923.png" alt="image-20201102095046923" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095114420.png" alt="image-20201102095114420" style="zoom:50%;" />

<h3 id="8-1-2、通过环境变量暴露元数据"><a href="#8-1-2、通过环境变量暴露元数据" class="headerlink" title="8.1.2、通过环境变量暴露元数据"></a>8.1.2、通过环境变量暴露元数据</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095213342.png" alt="image-20201102095213342" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095234670.png" alt="image-20201102095234670" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095308602.png" alt="image-20201102095308602" style="zoom:50%;" />

<h3 id="8-1-3、通过downwardAPI卷来传递元数据"><a href="#8-1-3、通过downwardAPI卷来传递元数据" class="headerlink" title="8.1.3、通过downwardAPI卷来传递元数据"></a>8.1.3、通过downwardAPI卷来传递元数据</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095430715.png" alt="image-20201102095430715" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095502746.png" alt="image-20201102095502746" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095529755.png" alt="image-20201102095529755" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095641916.png" alt="image-20201102095641916" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095836306.png" alt="image-20201102095836306" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095857600.png" alt="image-20201102095857600" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102095938694.png" alt="image-20201102095938694" style="zoom:50%;" />

<h2 id="8-2、与Kubernetes-API服务器交互"><a href="#8-2、与Kubernetes-API服务器交互" class="headerlink" title="8.2、与Kubernetes API服务器交互"></a>8.2、与Kubernetes API服务器交互</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100117040.png" alt="image-20201102100117040" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100136191.png" alt="image-20201102100136191" style="zoom:50%;" />

<h3 id="8-2-1、探究Kubernetes-REST-API"><a href="#8-2-1、探究Kubernetes-REST-API" class="headerlink" title="8.2.1、探究Kubernetes REST API"></a>8.2.1、探究Kubernetes REST API</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 得到服务器的URL</span></span><br><span class="line">kubect1 cluster-info</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100401365.png" alt="image-20201102100401365" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100504403.png" alt="image-20201102100504403" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100637036.png" alt="image-20201102100637036" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100743235.png" alt="image-20201102100743235" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100803852.png" alt="image-20201102100803852" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102100822026.png" alt="image-20201102100822026" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101121323.png" alt="image-20201102101121323" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101158492.png" alt="image-20201102101158492" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101259904.png" alt="image-20201102101259904" style="zoom:50%;" />

<h3 id="8-2-2、从Pod内部与API服务器进行交互"><a href="#8-2-2、从Pod内部与API服务器进行交互" class="headerlink" title="8.2.2、从Pod内部与API服务器进行交互"></a>8.2.2、从Pod内部与API服务器进行交互</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101347850.png" alt="image-20201102101347850" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101435083.png" alt="image-20201102101435083" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101500333.png" alt="image-20201102101500333" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101558270.png" alt="image-20201102101558270" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101704754.png" alt="image-20201102101704754" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101826003.png" alt="image-20201102101826003" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101918819.png" alt="image-20201102101918819" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102101939730.png" alt="image-20201102101939730" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102035568.png" alt="image-20201102102035568" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102147660.png" alt="image-20201102102147660" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102207254.png" alt="image-20201102102207254" style="zoom:50%;" />

<h3 id="8-2-3、通过ambassador容器简化与API服务器的交互"><a href="#8-2-3、通过ambassador容器简化与API服务器的交互" class="headerlink" title="8.2.3、通过ambassador容器简化与API服务器的交互"></a>8.2.3、通过ambassador容器简化与API服务器的交互</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102352872.png" alt="image-20201102102352872" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102412533.png" alt="image-20201102102412533" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102442249.png" alt="image-20201102102442249" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102647838.png" alt="image-20201102102647838" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102725127.png" alt="image-20201102102725127" style="zoom:50%;" />

<h3 id="8-2-4、使用客户端与API服务器交互"><a href="#8-2-4、使用客户端与API服务器交互" class="headerlink" title="8.2.4、使用客户端与API服务器交互"></a>8.2.4、使用客户端与API服务器交互</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102810272.png" alt="image-20201102102810272" style="zoom:50%;" />

<h2 id="8-3、本章小结"><a href="#8-3、本章小结" class="headerlink" title="8.3、本章小结"></a>8.3、本章小结</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102834119.png" alt="image-20201102102834119" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102102900493.png" alt="image-20201102102900493" style="zoom:50%;" />

<h1 id="9、Deployment：声明式地升级应用"><a href="#9、Deployment：声明式地升级应用" class="headerlink" title="9、Deployment：声明式地升级应用"></a>9、Deployment：声明式地升级应用</h1><h2 id="9-1、更新Pod内的应用程序"><a href="#9-1、更新Pod内的应用程序" class="headerlink" title="9.1、更新Pod内的应用程序"></a>9.1、更新Pod内的应用程序</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102114848983.png" alt="image-20201102114848983" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102114957590.png" alt="image-20201102114957590" style="zoom:50%;" />

<h3 id="9-1-1、先删旧Pod再创新Pod"><a href="#9-1-1、先删旧Pod再创新Pod" class="headerlink" title="9.1.1、先删旧Pod再创新Pod"></a>9.1.1、先删旧Pod再创新Pod</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115310955.png" alt="image-20201102115310955" style="zoom:50%;" />

<h3 id="9-1-2、先创新Pod再删旧Pod"><a href="#9-1-2、先创新Pod再删旧Pod" class="headerlink" title="9.1.2、先创新Pod再删旧Pod"></a>9.1.2、先创新Pod再删旧Pod</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115151713.png" alt="image-20201102115151713" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115449358.png" alt="image-20201102115449358" style="zoom:50%;" />

<h2 id="9-2、使用RC实现自动的滚动升级"><a href="#9-2、使用RC实现自动的滚动升级" class="headerlink" title="9.2、使用RC实现自动的滚动升级"></a>9.2、使用RC实现自动的滚动升级</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115554146.png" alt="image-20201102115554146" style="zoom:50%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rolling-update kubia-vl kubia-v2 --image&#x3D;luksa&#x2F;kubia:v2</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115746599.png" alt="image-20201102115746599" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115809983.png" alt="image-20201102115809983" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102115909828.png" alt="image-20201102115909828" style="zoom:50%;" />

<h3 id="9-2-3、kubectl-rolling-update-过时原因"><a href="#9-2-3、kubectl-rolling-update-过时原因" class="headerlink" title="9.2.3、kubectl rolling-update 过时原因"></a>9.2.3、kubectl rolling-update 过时原因</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120036320.png" alt="image-20201102120036320" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120141706.png" alt="image-20201102120141706" style="zoom:50%;" />

<h2 id="9-3、使用Deployment声明式地升级应用"><a href="#9-3、使用Deployment声明式地升级应用" class="headerlink" title="9.3、使用Deployment声明式地升级应用"></a>9.3、使用Deployment声明式地升级应用</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120322937.png" alt="image-20201102120322937" style="zoom:50%;" />

<h3 id="9-3-1、创建一个Deployment"><a href="#9-3-1、创建一个Deployment" class="headerlink" title="9.3.1、创建一个Deployment"></a>9.3.1、创建一个Deployment</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120443249.png" alt="image-20201102120443249" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个Deployment</span></span><br><span class="line">kubect1 create -f kubia-deploymentvl.yaml --record</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：确保在创建时使用了 –record 选项。 这个选项会记录历史版本号， 在 之后的操作中非常有用</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看部署状态</span></span><br><span class="line">kubectl rollout status deployment kubia</span><br><span class="line">kubectl get deployment</span><br><span class="line">kubectl describe deployment</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120756595.png" alt="image-20201102120756595" style="zoom:50%;" />

<h3 id="9-3-2、升级Deployment"><a href="#9-3-2、升级Deployment" class="headerlink" title="9.3.2、升级Deployment"></a>9.3.2、升级Deployment</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102120916202.png" alt="image-20201102120916202" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 减慢滚动升级的速度</span></span><br><span class="line">kubectl patch deployment kubia -p &#x27;&#123;&quot;spec&quot;: &#123;&quot;minReadySeconds&quot;: 10&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示：kubectl patch对于修改单个或者少量资源属性非常有用， 不需要再通 过编辑器编辑</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 触发滚动升级</span></span><br><span class="line">kubectl set image deployment kubia nodejs=luksa/kubia:v2</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121059977.png" alt="image-20201102121059977" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121138457.png" alt="image-20201102121138457" style="zoom:50%;" />

<h3 id="9-3-3、回滚Deployment"><a href="#9-3-3、回滚Deployment" class="headerlink" title="9.3.3、回滚Deployment"></a>9.3.3、回滚Deployment</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 回滚到上个版本</span></span><br><span class="line">kubectl rollout undo deployment kubia</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 回滚到一个特定版本</span></span><br><span class="line">kubectl rollout undo deployment kubia --to-revision=l</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121339077.png" alt="image-20201102121339077" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121438449.png" alt="image-20201102121438449" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121554411.png" alt="image-20201102121554411" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121610669.png" alt="image-20201102121610669" style="zoom:50%;" />

<h3 id="9-3-4、控制滚动升级速率"><a href="#9-3-4、控制滚动升级速率" class="headerlink" title="9.3.4、控制滚动升级速率"></a>9.3.4、控制滚动升级速率</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121649738.png" alt="image-20201102121649738" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121707945.png" alt="image-20201102121707945" style="zoom:50%;" />

<h3 id="9-3-5、暂停滚动升级"><a href="#9-3-5、暂停滚动升级" class="headerlink" title="9.3.5、暂停滚动升级"></a>9.3.5、暂停滚动升级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 触发滚动升级</span></span><br><span class="line">kubectl set image deployment kubia nodejs=luksa/kubia:v2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 暂停升级</span></span><br><span class="line">kubectl rollout pause deployment kubia</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复升级</span></span><br><span class="line">kubectl rollout resume deployment kubia</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102121952728.png" alt="image-20201102121952728" style="zoom:50%;" />

<h3 id="9-3-6、阻止出错版本的滚动升级"><a href="#9-3-6、阻止出错版本的滚动升级" class="headerlink" title="9.3.6、阻止出错版本的滚动升级"></a>9.3.6、阻止出错版本的滚动升级</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102122106601.png" alt="image-20201102122106601" style="zoom:50%;" />

<h2 id="9-4、本章小结"><a href="#9-4、本章小结" class="headerlink" title="9.4、本章小结"></a>9.4、本章小结</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102122256270.png" alt="image-20201102122256270" style="zoom:50%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/10/31/k8s/Kubernetes%20in%20Action%20%E7%AC%94%E8%AE%B06%EF%BD%9E7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/10/31/k8s/Kubernetes%20in%20Action%20%E7%AC%94%E8%AE%B06%EF%BD%9E7/" class="post-title-link" itemprop="url">Kubernetes in Action 6～7</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-31 16:03:03" itemprop="dateCreated datePublished" datetime="2020-10-31T16:03:03+08:00">2020-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 22:49:20" itemprop="dateModified" datetime="2021-01-14T22:49:20+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="6、将磁盘挂载到容器"><a href="#6、将磁盘挂载到容器" class="headerlink" title="6、将磁盘挂载到容器"></a>6、将磁盘挂载到容器</h1><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031164441918.png" alt="image-20201031164441918" style="zoom:50%;" />

<h2 id="6-1、介绍卷"><a href="#6-1、介绍卷" class="headerlink" title="6.1、介绍卷"></a>6.1、介绍卷</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101180919902.png" alt="image-20201101180919902" style="zoom:50%;" />

<h3 id="6-1-1、卷的应用示例"><a href="#6-1-1、卷的应用示例" class="headerlink" title="6.1.1、卷的应用示例"></a>6.1.1、卷的应用示例</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101180957339.png" alt="image-20201101180957339" style="zoom:50%;" />

<h3 id="6-1-2、可用的卷类型"><a href="#6-1-2、可用的卷类型" class="headerlink" title="6.1.2、可用的卷类型"></a>6.1.2、可用的卷类型</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181104715.png" alt="image-20201101181104715" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181128031.png" alt="image-20201101181128031" style="zoom:50%;" />

<h2 id="6-2、对卷的简单使用"><a href="#6-2、对卷的简单使用" class="headerlink" title="6.2、对卷的简单使用"></a>6.2、对卷的简单使用</h2><h3 id="6-2-1、使用emptyDir卷"><a href="#6-2-1、使用emptyDir卷" class="headerlink" title="6.2.1、使用emptyDir卷"></a>6.2.1、使用emptyDir卷</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181443766.png" alt="image-20201101181443766" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181535786.png" alt="image-20201101181535786" style="zoom:50%;" />

<h3 id="6-2-2、使用Git仓库作为存储卷"><a href="#6-2-2、使用Git仓库作为存储卷" class="headerlink" title="6.2.2、使用Git仓库作为存储卷"></a>6.2.2、使用Git仓库作为存储卷</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181623341.png" alt="image-20201101181623341" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181659454.png" alt="image-20201101181659454" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181719201.png" alt="image-20201101181719201" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181812270.png" alt="image-20201101181812270" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101181945573.png" alt="image-20201101181945573" style="zoom:50%;" />

<h2 id="6-3、hostPath卷"><a href="#6-3、hostPath卷" class="headerlink" title="6.3、hostPath卷"></a>6.3、hostPath卷</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182055310.png" alt="image-20201101182055310" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182156124.png" alt="image-20201101182156124" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182255606.png" alt="image-20201101182255606" style="zoom:50%;" />

<h2 id="6-4、使用持久化存储"><a href="#6-4、使用持久化存储" class="headerlink" title="6.4、使用持久化存储"></a>6.4、使用持久化存储</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182358317.png" alt="image-20201101182358317" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182656710.png" alt="image-20201101182656710" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182725860.png" alt="image-20201101182725860" style="zoom:50%;" />



<p>使用NFS的示例：</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101182821505.png" alt="image-20201101182821505" style="zoom:50%;" />

<h2 id="6-5、从底层存储技术解藕Pod"><a href="#6-5、从底层存储技术解藕Pod" class="headerlink" title="6.5、从底层存储技术解藕Pod"></a>6.5、从底层存储技术解藕Pod</h2><h3 id="6-5-1、持久卷和持久卷声明"><a href="#6-5-1、持久卷和持久卷声明" class="headerlink" title="6.5.1、持久卷和持久卷声明"></a>6.5.1、持久卷和持久卷声明</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183116342.png" alt="image-20201101183116342" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183131646.png" alt="image-20201101183131646" style="zoom:50%;" />

<h3 id="6-5-2、创建持久卷"><a href="#6-5-2、创建持久卷" class="headerlink" title="6.5.2、创建持久卷"></a>6.5.2、创建持久卷</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183425935.png" alt="image-20201101183425935" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出 pv，pv 也用作 persistentvolurne 的简写</span></span><br><span class="line">kubectl get pv</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意:持久卷不属于任何命名空间, 它跟节点一样是集群层面的资源</p>
</blockquote>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183655453.png" alt="image-20201101183655453" style="zoom:50%;" />

<h3 id="6-5-3、创建持久卷声明-获取持久卷"><a href="#6-5-3、创建持久卷声明-获取持久卷" class="headerlink" title="6.5.3、创建持久卷声明 获取持久卷"></a>6.5.3、创建持久卷声明 获取持久卷</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183808834.png" alt="image-20201101183808834" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183830365.png" alt="image-20201101183830365" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101183922360.png" alt="image-20201101183922360" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101184016103.png" alt="image-20201101184016103" style="zoom:50%;" />

<h3 id="6-5-4、在Pod中使用持久卷声明"><a href="#6-5-4、在Pod中使用持久卷声明" class="headerlink" title="6.5.4、在Pod中使用持久卷声明"></a>6.5.4、在Pod中使用持久卷声明</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101184239150.png" alt="image-20201101184239150" style="zoom:50%;" />

<h3 id="6-5-5、PV和PVC的优点"><a href="#6-5-5、PV和PVC的优点" class="headerlink" title="6.5.5、PV和PVC的优点"></a>6.5.5、PV和PVC的优点</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101184414310.png" alt="image-20201101184414310" style="zoom:50%;" />

<h3 id="6-5-6、回收持久卷"><a href="#6-5-6、回收持久卷" class="headerlink" title="6.5.6、回收持久卷"></a>6.5.6、回收持久卷</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101184646629.png" alt="image-20201101184646629" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101185221382.png" alt="image-20201101185221382" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101185312197.png" alt="image-20201101185312197" style="zoom:50%;" />

<h2 id="6-6、持久卷的动态卷配置"><a href="#6-6、持久卷的动态卷配置" class="headerlink" title="6.6、持久卷的动态卷配置"></a>6.6、持久卷的动态卷配置</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191023699.png" alt="image-20201101191023699" style="zoom:50%;" />

<h3 id="6-6-1、定义StorageClass创建可用存储类型"><a href="#6-6-1、定义StorageClass创建可用存储类型" class="headerlink" title="6.6.1、定义StorageClass创建可用存储类型"></a>6.6.1、定义StorageClass创建可用存储类型</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191436804.png" alt="image-20201101191436804" style="zoom:50%;" />

<h3 id="6-6-2、指定存储类创建PVC"><a href="#6-6-2、指定存储类创建PVC" class="headerlink" title="6.6.2、指定存储类创建PVC"></a>6.6.2、指定存储类创建PVC</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191531356.png" alt="image-20201101191531356" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191602331.png" alt="image-20201101191602331" style="zoom:50%;" />

<h3 id="6-6-3、不指定存储类的动态配置"><a href="#6-6-3、不指定存储类的动态配置" class="headerlink" title="6.6.3、不指定存储类的动态配置"></a>6.6.3、不指定存储类的动态配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">列出存储类,sc 是 storageclass 的缩写</span></span><br><span class="line">kubectl get sc</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191907662.png" alt="image-20201101191907662" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101191923642.png" alt="image-20201101191923642" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101192036249.png" alt="image-20201101192036249" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101192126774.png" alt="image-20201101192126774" style="zoom:50%;" />

<h2 id="6-7、本章小结"><a href="#6-7、本章小结" class="headerlink" title="6.7、本章小结"></a>6.7、本章小结</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101192210879.png" alt="image-20201101192210879" style="zoom:50%;" />

<h1 id="7、ConfigMap和Secret：配置应用程序"><a href="#7、ConfigMap和Secret：配置应用程序" class="headerlink" title="7、ConfigMap和Secret：配置应用程序"></a>7、ConfigMap和Secret：配置应用程序</h1><h2 id="7-1、配置容器化应用程序"><a href="#7-1、配置容器化应用程序" class="headerlink" title="7.1、配置容器化应用程序"></a>7.1、配置容器化应用程序</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101231456353.png" alt="image-20201101231456353" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101231556247.png" alt="image-20201101231556247" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101231611948.png" alt="image-20201101231611948" style="zoom:50%;" />

<h2 id="7-2、向容器传递命令行参数"><a href="#7-2、向容器传递命令行参数" class="headerlink" title="7.2、向容器传递命令行参数"></a>7.2、向容器传递命令行参数</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101231717015.png" alt="image-20201101231717015" style="zoom:50%;" />

<h3 id="7-2-1、在Docker中定义命令与参数"><a href="#7-2-1、在Docker中定义命令与参数" class="headerlink" title="7.2.1、在Docker中定义命令与参数"></a>7.2.1、在Docker中定义命令与参数</h3><p>容器中运行的完整指令由两部分组成:<strong>命令</strong>与<strong>参数</strong></p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101231902676.png" alt="image-20201101231902676" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232004787.png" alt="image-20201101232004787" style="zoom:50%;" />

<h3 id="7-2-2、在Kubernetes中覆盖命令和参数"><a href="#7-2-2、在Kubernetes中覆盖命令和参数" class="headerlink" title="7.2.2、在Kubernetes中覆盖命令和参数"></a>7.2.2、在Kubernetes中覆盖命令和参数</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232151021.png" alt="image-20201101232151021" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232219200.png" alt="image-20201101232219200" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232407007.png" alt="image-20201101232407007" style="zoom:50%;" />

<h2 id="7-3、为容器设置环境变量"><a href="#7-3、为容器设置环境变量" class="headerlink" title="7.3、为容器设置环境变量"></a>7.3、为容器设置环境变量</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232530430.png" alt="image-20201101232530430" style="zoom:50%;" />

<h3 id="7-3-1、容器定义中指定环境变量"><a href="#7-3-1、容器定义中指定环境变量" class="headerlink" title="7.3.1、容器定义中指定环境变量"></a>7.3.1、容器定义中指定环境变量</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232723669.png" alt="image-20201101232723669" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101232814979.png" alt="image-20201101232814979" style="zoom:50%;" />

<h2 id="7-4、利用ConfigMap解藕配置"><a href="#7-4、利用ConfigMap解藕配置" class="headerlink" title="7.4、利用ConfigMap解藕配置"></a>7.4、利用ConfigMap解藕配置</h2><h3 id="7-4-1、ConfigMap介绍"><a href="#7-4-1、ConfigMap介绍" class="headerlink" title="7.4.1、ConfigMap介绍"></a>7.4.1、ConfigMap介绍</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233020236.png" alt="image-20201101233020236" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233051707.png" alt="image-20201101233051707" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233112125.png" alt="image-20201101233112125" style="zoom:50%;" />

<h3 id="7-4-2、创建ConfigMap"><a href="#7-4-2、创建ConfigMap" class="headerlink" title="7.4.2、创建ConfigMap"></a>7.4.2、创建ConfigMap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接创建 ConfigMap</span></span><br><span class="line">kubectl create configmap fortune-config -- from-literal=sleep-interval=25</span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以包含多个键值对</span></span><br><span class="line">kubectl create configmap myconfigmap</span><br><span class="line">--from-literal=foo=bar --from-literal=bar=baz --from-literal=one=two</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233249963.png" alt="image-20201101233249963" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233401146.png" alt="image-20201101233401146" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从 YAML 文件中创建</span></span><br><span class="line">kubectl create -f fortune-config.ymal</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从文件内容中创建，key默认为文件名 config-file.conf</span></span><br><span class="line">kubectl create configmap my-config --from-file=config-file.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定key，此时key 为 customkey</span></span><br><span class="line">kubectl create configmap my-config -from-file=customkey=config-file.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从文件夹创建ConfigMap，kuebctl会为文件夹中的每个文件创建单独的条目（仅限文件名可作为合法key的文件）</span></span><br><span class="line">kubectl create configmap my -config --from-file=/path/to/dir</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233841598.png" alt="image-20201101233841598" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101233916432.png" alt="image-20201101233916432" style="zoom:50%;" />

<h3 id="7-4-3、给容器传递ConfigMap作为环境变量"><a href="#7-4-3、给容器传递ConfigMap作为环境变量" class="headerlink" title="7.4.3、给容器传递ConfigMap作为环境变量"></a>7.4.3、给容器传递ConfigMap作为环境变量</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234128116.png" alt="image-20201101234128116" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234200047.png" alt="image-20201101234200047" style="zoom:50%;" />

<h3 id="7-4-4、一次性传递ConfigMap的所有条目作为环境变量"><a href="#7-4-4、一次性传递ConfigMap的所有条目作为环境变量" class="headerlink" title="7.4.4、一次性传递ConfigMap的所有条目作为环境变量"></a>7.4.4、一次性传递ConfigMap的所有条目作为环境变量</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234415640.png" alt="image-20201101234415640" style="zoom:50%;" />

<h3 id="7-4-5、传递ConfigMap条目作为命令行参数"><a href="#7-4-5、传递ConfigMap条目作为命令行参数" class="headerlink" title="7.4.5、传递ConfigMap条目作为命令行参数"></a>7.4.5、传递ConfigMap条目作为命令行参数</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234635903.png" alt="image-20201101234635903" style="zoom:50%;" />

<h3 id="7-4-6、使用ConfigMap卷将条目暴露为文件"><a href="#7-4-6、使用ConfigMap卷将条目暴露为文件" class="headerlink" title="7.4.6、使用ConfigMap卷将条目暴露为文件"></a>7.4.6、使用ConfigMap卷将条目暴露为文件</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234816039.png" alt="image-20201101234816039" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101234931355.png" alt="image-20201101234931355" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235023092.png" alt="image-20201101235023092" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235104748.png" alt="image-20201101235104748" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235137956.png" alt="image-20201101235137956" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235219089.png" alt="image-20201101235219089" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235345639.png" alt="image-20201101235345639" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235516613.png" alt="image-20201101235516613" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235621589.png" alt="image-20201101235621589" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235656494.png" alt="image-20201101235656494" style="zoom:50%;" />

<h3 id="7-4-7、更新应用配置且不重启应用程序"><a href="#7-4-7、更新应用配置且不重启应用程序" class="headerlink" title="7.4.7、更新应用配置且不重启应用程序"></a>7.4.7、更新应用配置且不重启应用程序</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201101235819663.png" alt="image-20201101235819663" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改configMap</span></span><br><span class="line">kubect1 edit configmap fortune-config</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 手动通知Nginx重载配置</span></span><br><span class="line">kubectl exec fortune-configmap-volume -c web-server -- nginx -s reload</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000110904.png" alt="image-20201102000110904" style="zoom:50%;" />

<h2 id="7-5、使用Secret给容器传递敏感数据"><a href="#7-5、使用Secret给容器传递敏感数据" class="headerlink" title="7.5、使用Secret给容器传递敏感数据"></a>7.5、使用Secret给容器传递敏感数据</h2><h3 id="7-5-1、介绍Secret"><a href="#7-5-1、介绍Secret" class="headerlink" title="7.5.1、介绍Secret"></a>7.5.1、介绍Secret</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000336053.png" alt="image-20201102000336053" style="zoom:50%;" />

<h3 id="7-5-2、默认令牌Secret介绍"><a href="#7-5-2、默认令牌Secret介绍" class="headerlink" title="7.5.2、默认令牌Secret介绍"></a>7.5.2、默认令牌Secret介绍</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000437374.png" alt="image-20201102000437374" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000530790.png" alt="image-20201102000530790" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000627880.png" alt="image-20201102000627880" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102000706527.png" alt="image-20201102000706527" style="zoom:50%;" />

<h3 id="7-5-3、创建Secret"><a href="#7-5-3、创建Secret" class="headerlink" title="7.5.3、创建Secret"></a>7.5.3、创建Secret</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在本地机器生成私钥和证书</span></span><br><span class="line">openssl genrsa -https.key 2048</span><br><span class="line">openssl req -new -x509 -key https.key -out https.cert -days 3650 -subj /CN=www.kubia-example.com</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 额外创建一个字符串文件（后续截图中会看到）</span></span><br><span class="line">echo bar &gt; foo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建generic secret</span></span><br><span class="line">kubectl create secret generic fortune-https --from-file=https.key --from-file=https.cert --from-file=foo</span><br></pre></td></tr></table></figure>
<h3 id="7-5-4、对比ConfigMap和Secret"><a href="#7-5-4、对比ConfigMap和Secret" class="headerlink" title="7.5.4、对比ConfigMap和Secret"></a>7.5.4、对比ConfigMap和Secret</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102005808904.png" alt="image-20201102005808904" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102005956272.png" alt="image-20201102005956272" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010031496.png" alt="image-20201102010031496" style="zoom:50%;" />

<h3 id="7-5-5、在Pod中使用Secret"><a href="#7-5-5、在Pod中使用Secret" class="headerlink" title="7.5.5、在Pod中使用Secret"></a>7.5.5、在Pod中使用Secret</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010215437.png" alt="image-20201102010215437" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010245097.png" alt="image-20201102010245097" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010346454.png" alt="image-20201102010346454" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010441850.png" alt="image-20201102010441850" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010512935.png" alt="image-20201102010512935" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010649890.png" alt="image-20201102010649890" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010752866.png" alt="image-20201102010752866" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010815337.png" alt="image-20201102010815337" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010914427.png" alt="image-20201102010914427" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102010952198.png" alt="image-20201102010952198" style="zoom:50%;" />

<h3 id="7-6、本章小结"><a href="#7-6、本章小结" class="headerlink" title="7.6、本章小结"></a>7.6、本章小结</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201102011021921.png" alt="image-20201102011021921" style="zoom:50%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/10/29/k8s/Kubernets%20in%20Action%20-%20%E7%AC%94%E8%AE%B01%EF%BD%9E5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/10/29/k8s/Kubernets%20in%20Action%20-%20%E7%AC%94%E8%AE%B01%EF%BD%9E5/" class="post-title-link" itemprop="url">Kubernetes in Action 1～5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-29 16:32:46" itemprop="dateCreated datePublished" datetime="2020-10-29T16:32:46+08:00">2020-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 23:14:13" itemprop="dateModified" datetime="2021-01-14T23:14:13+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1、概览"><a href="#1、概览" class="headerlink" title="1、概览"></a>1、概览</h1><h2 id="1-1、容器技术介绍"><a href="#1-1、容器技术介绍" class="headerlink" title="1.1、容器技术介绍"></a>1.1、容器技术介绍</h2><h3 id="1-1-1、命名空间和Cgroup"><a href="#1-1-1、命名空间和Cgroup" class="headerlink" title="1.1.1、命名空间和Cgroup"></a>1.1.1、命名空间和Cgroup</h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114230955066.png" alt="image-20210114230955066" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231005841.png" alt="image-20210114231005841" style="zoom:50%;" />



<ol>
<li><p>UTS 名称空间：又称为主机名名称空间，保存内核名称、版本以及主机名和域名。</p>
</li>
<li><p>ipc 名称空间：进程间通信名称空间，IPC的隔离就是阻断进程间通信，主要是信号量、队列和共享内存。运行主机进程通过上面的机制进行通信。</p>
</li>
<li><p>mnt 名称空间：提供对磁盘挂载点和文件系统的隔离能力。同一主机上的不同进程访问相同的路径会得到相同的内容，因为它们共享本地主机的磁盘和文件系统。</p>
<p>在同一POD内容器之间挂载点名称空间是隔离的，如果该POD的多个容器挂载一个POD级别的Volume，那么它们就可以实现挂载点的共享，但共享的也仅仅是这一个Volume并不是整个文件系统</p>
</li>
<li><p>net 名称空间：网络名称空间，同一主机上的不同进程可以进行localhost或者本地unix socket通信。在单独启动容器的时候不同容器是隔离的，但是在POD中不同容器通过一个Infra容器来进行共享网络名称空间，其原理是其他用户自己定义的容器都Join这个Infra容器的网络。</p>
</li>
<li><p>PID 名称空间：进程ID名称空间，同一主机上的不同进程在同一PID空间内可以看到其他进程的ID，并且同一PID空间的进程的ID不会重复。另外PID名称空间有层级关系，子空间看不到父空间的内容，但是父空间可以管理子空间，比如发送信号。</p>
<p>在POD中则对应为同一POD内的不同容器可以看到对方的进程ID。默认不是共享的，可以设置POD的<code>shareProcessNamespace</code>这个值为true来进行共享，默认为false。</p>
</li>
<li><p>User 名称空间：隔离用户、组以及相关用户能力的。也就是在不同的User Namespace中，相同的用户可以有不同的UID或者不同的权限。另外还可以通过映射的方式把某个User Namespace的用户映射到另外一个User Namespace的用户上，这样这两个名称可能不同的用户就具有相同的权限。</p>
</li>
</ol>
<blockquote>
<p>参见这篇文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/rexcheny/p/11017146.html">同一个POD中默认共享哪些名称空间</a></p>
</blockquote>
<h3 id="1-1-2、进程与namespace关联"><a href="#1-1-2、进程与namespace关联" class="headerlink" title="1.1.2、进程与namespace关联"></a>1.1.2、进程与namespace关联</h3><p>一个进程可以属于多个namesapce,既然namespace和进程相关，那么在task_struct结构体中就会包含和namespace相关联的变量。在task_struct 结构中有一个指向namespace结构体的指针nsproxy。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">struct task_struct</span><br><span class="line">&#123;</span><br><span class="line">……..</span><br><span class="line">&#x2F;* namespaces *&#x2F;</span><br><span class="line">         struct nsproxy *nsproxy;</span><br><span class="line">…….</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看一下<a target="_blank" rel="noopener" href="http://lxr.free-electrons.com/source/include/linux/nsproxy.h#L29">nsproxy</a>是如何定义的，在<a target="_blank" rel="noopener" href="http://lxr.free-electrons.com/source/include/linux/nsproxy.h">include/linux/nsproxy.h</a>文件中，这里一共定义了5个各自的命名空间结构体，在该结构体中定义了5个指向各个类型namespace的指针，由于多个进程可以使用同一个namespace，所以nsproxy可以共享使用，count字段是该结构的引用计数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* &#x27;count&#x27; is the number of tasks holding a reference.</span></span><br><span class="line"><span class="comment"> * The count for each namespace, then, will be the number</span></span><br><span class="line"><span class="comment"> * of nsproxies pointing to it, not the number of tasks.</span></span><br><span class="line"><span class="comment"> * The nsproxy is shared by tasks which share all namespaces.</span></span><br><span class="line"><span class="comment"> * As soon as a single namespace is cloned or unshared, the</span></span><br><span class="line"><span class="comment"> * nsproxy is copied</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nsproxy</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">         <span class="keyword">atomic_t</span> count;</span><br><span class="line">         <span class="class"><span class="keyword">struct</span> <span class="title">uts_namespace</span> *<span class="title">uts_ns</span>;</span></span><br><span class="line">         <span class="class"><span class="keyword">struct</span> <span class="title">ipc_namespace</span> *<span class="title">ipc_ns</span>;</span></span><br><span class="line">         <span class="class"><span class="keyword">struct</span> <span class="title">mnt_namespace</span> *<span class="title">mnt_ns</span>;</span></span><br><span class="line">         <span class="class"><span class="keyword">struct</span> <span class="title">pid_namespace</span> *<span class="title">pid_ns_for_children</span>;</span></span><br><span class="line">         <span class="class"><span class="keyword">struct</span> <span class="title">net</span>             *<span class="title">net_ns</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="1-1-3、Docker"><a href="#1-1-3、Docker" class="headerlink" title="1.1.3、Docker"></a>1.1.3、Docker</h3><p>Docker是一个打包、分发和运行应用程序的平台。它允许将你的应用程序和应用程序所依赖的整个环境打包在一起。</p>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231119419.png" alt="image-20210114231119419" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029165644793.png" alt="image-20201029165644793" style="zoom:50%;" />

<h2 id="1-2、Kubernetes介绍"><a href="#1-2、Kubernetes介绍" class="headerlink" title="1.2、Kubernetes介绍"></a>1.2、Kubernetes介绍</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231025490.png" alt="image-20210114231025490" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231034261.png" alt="image-20210114231034261" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231154199.png" alt="image-20210114231154199" style="zoom:50%;" />

<h1 id="2、开始使用Kubetnetes和Docker"><a href="#2、开始使用Kubetnetes和Docker" class="headerlink" title="2、开始使用Kubetnetes和Docker"></a>2、开始使用Kubetnetes和Docker</h1><h2 id="共享容器镜像"><a href="#共享容器镜像" class="headerlink" title="共享容器镜像"></a>共享容器镜像</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231222684.png" alt="image-20210114231222684" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231235787.png" alt="image-20210114231235787" style="zoom:50%;" />

<h2 id="在Kubernetes运行第一个容器"><a href="#在Kubernetes运行第一个容器" class="headerlink" title="在Kubernetes运行第一个容器"></a>在Kubernetes运行第一个容器</h2><h3 id="1、部署Node-js应用"><a href="#1、部署Node-js应用" class="headerlink" title="1、部署Node.js应用"></a>1、部署Node.js应用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">直接创建一个pod，而不需要json 或 YAML 文件</span></span><br><span class="line">kubectl run kubia --image=luksa/kubia --port=8080 --generator=run/vl</span><br></pre></td></tr></table></figure>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231252601.png" alt="image-20210114231252601" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029172252484.png" alt="image-20201029172252484" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231302412.png" alt="image-20210114231302412" style="zoom:50%;" />

<h3 id="2、访问web应用"><a href="#2、访问web应用" class="headerlink" title="2、访问web应用"></a>2、访问web应用</h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231317248.png" alt="image-20210114231317248" style="zoom:50%;" />

<p>要创建服务，需要告知Kubernetes对外暴露之前创建的ReplicationController：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose rc kubia --type=LoadBalancer --name kubia-http</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：这里的rc 是 ReplicationController 的缩写。其余的缩写例如，pods 的缩写是po，service的缩写是svc，等等</p>
</blockquote>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114231336882.png" alt="image-20210114231336882" style="zoom:50%;" />

<h3 id="3、系统的逻辑部分"><a href="#3、系统的逻辑部分" class="headerlink" title="3、系统的逻辑部分"></a>3、系统的逻辑部分</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029173632935.png" alt="image-20201029173632935" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029173813286.png" alt="image-20201029173813286" style="zoom:50%;" />

<h3 id="4、水平伸缩应用"><a href="#4、水平伸缩应用" class="headerlink" title="4、水平伸缩应用"></a>4、水平伸缩应用</h3><p>为了增加Pod 的副本数，需要改变ReplicationController期望的副本数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale re kubia --replicas=3</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029174051789.png" alt="image-20201029174051789" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029174132223.png" alt="image-20201029174132223" style="zoom:50%;" />

<h1 id="3、Pod：运行于Kubernetes中的容器"><a href="#3、Pod：运行于Kubernetes中的容器" class="headerlink" title="3、Pod：运行于Kubernetes中的容器"></a>3、Pod：运行于Kubernetes中的容器</h1><h2 id="3-1、介绍Pod"><a href="#3-1、介绍Pod" class="headerlink" title="3.1、介绍Pod"></a>3.1、介绍Pod</h2><p>Pod是一组并置的容器，一个pod绝不会跨越多个工作节点。</p>
<h3 id="为何多个容器比单个容器中包含多个进程要好"><a href="#为何多个容器比单个容器中包含多个进程要好" class="headerlink" title="为何多个容器比单个容器中包含多个进程要好"></a>为何多个容器比单个容器中包含多个进程要好</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029175111203.png" alt="image-20201029175111203" style="zoom:50%;" />

<h3 id="容器如何共享相同的IP和端口空间"><a href="#容器如何共享相同的IP和端口空间" class="headerlink" title="容器如何共享相同的IP和端口空间"></a>容器如何共享相同的IP和端口空间</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029203803094.png" alt="image-20201029203803094" style="zoom:50%;" />

<h3 id="Pod间的网络"><a href="#Pod间的网络" class="headerlink" title="Pod间的网络"></a>Pod间的网络</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029203929099.png" alt="image-20201029203929099" style="zoom:50%;" />

<h3 id="何时在Pod中使用多个容器"><a href="#何时在Pod中使用多个容器" class="headerlink" title="何时在Pod中使用多个容器"></a>何时在Pod中使用多个容器</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029204007577.png" alt="image-20201029204007577" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029204034572.png" alt="image-20201029204034572" style="zoom:50%;" />

<h2 id="3-2、以YAML或JSON描述文件创建Pod"><a href="#3-2、以YAML或JSON描述文件创建Pod" class="headerlink" title="3.2、以YAML或JSON描述文件创建Pod"></a>3.2、以YAML或JSON描述文件创建Pod</h2><p>Pod和其他Kubernetes资源通常是通过向 Kubernetes REST API 提供 JSON 或 YAML 描述文件来创建的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">检查现有Pod 的 YAML 描述文件</span></span><br><span class="line">kubectl get po kubia-zxzij -o ymal</span><br></pre></td></tr></table></figure>
<h3 id="Pod定义的主要部分"><a href="#Pod定义的主要部分" class="headerlink" title="Pod定义的主要部分"></a>Pod定义的主要部分</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029204531837.png" alt="image-20201029204531837" style="zoom:50%;" />

<ul>
<li>metadata：包括名称、命名空间、标签和关于该容器的信息</li>
<li>spec：包含pod内容的实际说明，例如Pod的容器、卷和其他数据</li>
<li>status：包含运行中的pod 的当前信息，例如Pod 所处的条件、每个容器的描述和状态、以及内部IP和其他基本信息。【status 部分包含只读的运行时数据，该数据展示了给定时刻的资源状态。在创建新Pod时，永远不需要提供status 部分】</li>
</ul>
<p>其他对象也有着上述相同的结构。</p>
<h3 id="为Pod创建简单的YMAL描述文件"><a href="#为Pod创建简单的YMAL描述文件" class="headerlink" title="为Pod创建简单的YMAL描述文件"></a>为Pod创建简单的YMAL描述文件</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029204953445.png" alt="image-20201029204953445" style="zoom:50%;" />



<p><strong>使用 Kubectl explain 来发现可能的API 对象字段</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl explain pods</span><br><span class="line">kubectl explain pods.spec</span><br></pre></td></tr></table></figure>
<h3 id="创建Pod"><a href="#创建Pod" class="headerlink" title="创建Pod"></a>创建Pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl create -f 用于从 YMAL 或 JSON 文件创建任何资源</span></span><br><span class="line">kubectl create -f kubia-manual.ymal</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 得到运行中 Pod 的完整定义</span></span><br><span class="line">kubectl getpo kubia-manual -o yaml</span><br><span class="line">kubectl getpo kubia-manual -o json</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看新创的 Pod</span></span><br><span class="line">kubectl get pods</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器日志</span></span><br><span class="line">docker logs &lt;container id&gt;</span><br><span class="line">kubectl logs kubia-manual</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取多容器pod 的日志时指定容器名称</span></span><br><span class="line">kubectl logs kubia-manual -c kubia</span><br></pre></td></tr></table></figure>
<h3 id="通过端口转发访问Pod"><a href="#通过端口转发访问Pod" class="headerlink" title="通过端口转发访问Pod"></a>通过端口转发访问Pod</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029210836745.png" alt="image-20201029210836745" style="zoom:50%;" />

<h2 id="3-3、使用标签组织Pod"><a href="#3-3、使用标签组织Pod" class="headerlink" title="3.3、使用标签组织Pod"></a>3.3、使用标签组织Pod</h2><p>标签是可以附加到资源的任意键值对。通常在我们创建资源时就会将标签附加到资源上，但之后我们可以再添加其他标签，或者修改现有的标签值，而无须重新创建资源。</p>
<h3 id="创建Pod时指定标签"><a href="#创建Pod时指定标签" class="headerlink" title="创建Pod时指定标签"></a>创建Pod时指定标签</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029211232513.png" alt="image-20201029211232513" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f kubia-manual-with-labels.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出 label</span></span><br><span class="line">kubectl get po --show-labels</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示 指定 label</span></span><br><span class="line">kubectl get po -L creation_method,env</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 手动添加 label</span></span><br><span class="line">kubecl label po test_pod creation_method=manual</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改现有标签时，需使用 --overwrite 选项</span></span><br><span class="line">kubecl label po kubia-manual-v2 env=debug --overwrite</span><br></pre></td></tr></table></figure>
<h3 id="通过标签选择器列出Pod子集"><a href="#通过标签选择器列出Pod子集" class="headerlink" title="通过标签选择器列出Pod子集"></a>通过标签选择器列出Pod子集</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029211710312.png" alt="image-20201029211710312" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定键值</span></span><br><span class="line">kubectl get po -1 creation_method=manual</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定键</span></span><br><span class="line">kubectl get po -1 env</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出没有该键的 pod</span></span><br><span class="line">kubectl get po -1 &#x27;!env&#x27;</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029211915638.png" alt="image-20201029211915638" style="zoom:50%;" />

<h3 id="将Pod-调度到特定节点"><a href="#将Pod-调度到特定节点" class="headerlink" title="将Pod 调度到特定节点"></a>将Pod 调度到特定节点</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用标签分类 工作节点</span></span><br><span class="line">kubectl label node gke-kubia-85f6-node-Orrx gpu=true</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029212200216.png" alt="image-20201029212200216" style="zoom:50%;" />

<blockquote>
<p>通过键 kubernetes.io/hostname 可将Pod 调度到指定节点</p>
</blockquote>
<h2 id="3-4、注解Pod"><a href="#3-4、注解Pod" class="headerlink" title="3.4、注解Pod"></a>3.4、注解Pod</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029212420815.png" alt="image-20201029212420815" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029212443564.png" alt="image-20201029212443564" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加注解</span></span><br><span class="line">kubect1 annotate pod kubia-manual mycompany.com/someannottion=&quot;foo bar&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查找Pod的信息，找到注解</span></span><br><span class="line">kubectl describe pod kubia-manual</span><br></pre></td></tr></table></figure>
<h2 id="3-5、使用命名空间对资源分组"><a href="#3-5、使用命名空间对资源分组" class="headerlink" title="3.5、使用命名空间对资源分组"></a>3.5、使用命名空间对资源分组</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029213056944.png" alt="image-20201029213056944" style="zoom:50%;" />

<p>大多数类型的资源都与命名空间相关，但仍有例外，比如节点资源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出ns</span></span><br><span class="line">kubectl get ns</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出指定 ns 的 pod</span></span><br><span class="line">kubectl get po --namespace kube-system</span><br><span class="line">kubectl get po -n kube-system</span><br></pre></td></tr></table></figure>
<blockquote>
<p>除了隔离资源，命名空间还可用于仅允许某些用户访问某些特定资源，甚至限制单个用户可用的计算资源数量</p>
</blockquote>
<h3 id="创建命名空间"><a href="#创建命名空间" class="headerlink" title="创建命名空间"></a>创建命名空间</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029213502340.png" alt="image-20201029213502340" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create - f custom-namespace.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 直接创建ns</span> </span><br><span class="line">kubectl create namespace custom-namespace</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建资源时指定ns</span></span><br><span class="line">kubectl create -f kubia-manual.yam1 -n custom-namespace</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029213821336.png" alt="image-20201029213821336" style="zoom:50%;" />

<h3 id="命名空间提供的隔离"><a href="#命名空间提供的隔离" class="headerlink" title="命名空间提供的隔离"></a>命名空间提供的隔离</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029213915166.png" alt="image-20201029213915166" style="zoom:50%;" />

<h2 id="3-6、停止和移除Pod"><a href="#3-6、停止和移除Pod" class="headerlink" title="3.6、停止和移除Pod"></a>3.6、停止和移除Pod</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除指定Pod</span></span><br><span class="line">kubectl delete po pod1 pod2</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029214018322.png" alt="image-20201029214018322" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 label 删除 pod</span></span><br><span class="line">kubectl delete po -1 rel=canary</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除整个命名空间，其中的所有资源都会被自动删除</span></span><br><span class="line">kubectl delete ns custom-namespace</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 命名空间中的 所有 pod</span></span><br><span class="line">kubectl delete po --all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除 命名空间中的 所有资源（第一个 all 指所有资源类型）</span></span><br><span class="line">kubectl delete all --all</span><br></pre></td></tr></table></figure>
<h1 id="4、副本机制和其他控制器：部署托管的Pod"><a href="#4、副本机制和其他控制器：部署托管的Pod" class="headerlink" title="4、副本机制和其他控制器：部署托管的Pod"></a>4、副本机制和其他控制器：部署托管的Pod</h1><p>手动创建的未托管Pod（即：未通过ReplicationSet、Deployment…创建的Pod），Kubernetes将自动监控它们，并在它们失败时自动重启它们。但如果整个节点失败，这些Pod将不会再其他节点重建。这就是需要控制器的原因。</p>
<h2 id="4-1、存活探针"><a href="#4-1、存活探针" class="headerlink" title="4.1、存活探针"></a>4.1、存活探针</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029234222394.png" alt="image-20201029234222394" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029234323102.png" alt="image-20201029234323102" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029234341428.png" alt="image-20201029234341428" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029234532119.png" alt="image-20201029234532119" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看前一个容器的日志（ kubectl logs 查看的是当前容器的日志，容器重启后，要查看前一个容器的日志，就需要加上 --previous ）</span></span><br><span class="line">kubectl logs mypod --previous</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以通过 describe 查看前个容器的重启原因</span></span><br><span class="line">kubectl describe po kubia-liveness</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：当容器被强行终止时，会创建一个全新的容器—-而不是重启原来的容器。</p>
</blockquote>
<h3 id="4-1-1、存活探针的属性"><a href="#4-1-1、存活探针的属性" class="headerlink" title="4.1.1、存活探针的属性"></a>4.1.1、存活探针的属性</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235036169.png" alt="image-20201029235036169" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置初识延迟，使用 initalDelaySeconds 属性，kubetnetes会在第一次探测前等待15s</span></span><br><span class="line">livenessProbe:</span><br><span class="line">  httpGet:</span><br><span class="line">    path: /</span><br><span class="line">    prot: 8000</span><br><span class="line">  initalDelaySeconds: 15</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：退出代码137（describe可看到）表示进程被外部信号终止， 表示退出代码为128+9 (SIGKILL)。 同样， 退出代码143对应于128+15 (SIGTERM)。</p>
</blockquote>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235646469.png" alt="image-20201029235646469" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235717681.png" alt="image-20201029235717681" style="zoom:50%;" />

<h2 id="4-2、ReplicationController"><a href="#4-2、ReplicationController" class="headerlink" title="4.2、ReplicationController"></a>4.2、ReplicationController</h2><h3 id="4-2-1、概览"><a href="#4-2-1、概览" class="headerlink" title="4.2.1、概览"></a>4.2.1、概览</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235812649.png" alt="image-20201029235812649" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235921158.png" alt="image-20201029235921158" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201029235943330.png" alt="image-20201029235943330" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030000011278.png" alt="image-20201030000011278" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030000506679.png" alt="image-20201030000506679" style="zoom:50%;" />

<h3 id="4-2-2、创建RC"><a href="#4-2-2、创建RC" class="headerlink" title="4.2.2、创建RC"></a>4.2.2、创建RC</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030000657397.png" alt="image-20201030000657397" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030000959047.png" alt="image-20201030000959047" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取 rc 的信息</span></span><br><span class="line">kubectl get rc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 rc 的详情</span></span><br><span class="line">kubectl describe rc &lt;rc_name&gt;</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030001349403.png" alt="image-20201030001349403" style="zoom:50%;" />

<h3 id="4-2-3、Pod从RC的移入移出"><a href="#4-2-3、Pod从RC的移入移出" class="headerlink" title="4.2.3、Pod从RC的移入移出"></a>4.2.3、Pod从RC的移入移出</h3><p>由ReplicationController创建的pod并不是绑定到ReplicationController。 在任何时刻， ReplicationController管理与标签选择器匹配的pod。 通过更改pod的标 签， 可以将它 从ReplicationController的作用域中添加或删除。 它甚至可以从一个ReplicationController 移动到另一个。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030001656144.png" alt="image-20201030001656144" style="zoom:50%;" />

<h3 id="4-2-4、修改Pod模板"><a href="#4-2-4、修改Pod模板" class="headerlink" title="4.2.4、修改Pod模板"></a>4.2.4、修改Pod模板</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030001852912.png" alt="image-20201030001852912" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">编辑修改 rc（可在其中，修改Pod模板）</span></span><br><span class="line">kubectl edit rc &lt;rc_name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4、水平缩放Pod"><a href="#4-2-4、水平缩放Pod" class="headerlink" title="4.2.4、水平缩放Pod"></a>4.2.4、水平缩放Pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接通过命令修改</span></span><br><span class="line">kubectl scale re &lt;rc_name&gt; --replicas=lO</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030002212638.png" alt="image-20201030002212638" style="zoom:50%;" />

<h3 id="4-2-5、删除rc"><a href="#4-2-5、删除rc" class="headerlink" title="4.2.5、删除rc"></a>4.2.5、删除rc</h3><p>当你通过 kubectl delete 删除 ReplicationController 时， pod 也会被删除。 但是由于由 ReplicationController 创建的 pod 不是 ReplicationController 的组成部分， 只是由其进行管理， 因此可以只删除ReplicationController 并保待 pod 运行。剩下的Pod可以再次被RC 或 ReplicaSet管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 只删除 rc</span></span><br><span class="line">kubectl delete re &lt;rc_name&gt; --cascade=false</span><br></pre></td></tr></table></figure>
<h2 id="4-3、使用ReplicaSet而不是RC"><a href="#4-3、使用ReplicaSet而不是RC" class="headerlink" title="4.3、使用ReplicaSet而不是RC"></a>4.3、使用ReplicaSet而不是RC</h2><p>ReplicaSet 的类似资源 。 它是新一 代的 ReplicationController。但你通常 不会直接创建它们， 而是在创建更高层级的 Deployment 资源时自动创建它们。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030002747694.png" alt="image-20201030002747694" style="zoom:50%;" />

<h3 id="4-3-1、创建ReplicaSet"><a href="#4-3-1、创建ReplicaSet" class="headerlink" title="4.3.1、创建ReplicaSet"></a>4.3.1、创建ReplicaSet</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030003035166.png" alt="image-20201030003035166" style="zoom:50%;" />

<p>唯 一的区别在选择器中。不必在selector属性中直接列出pod需要的标签， 而是在selector.rnatchLabels下指定它们。这是在ReplicaSet中定义标签选择器的更简单(也更不具表达力)的方式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检查 rs</span></span><br><span class="line">kubectl get rs</span><br><span class="line">kubectl describe rs rs_name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除</span></span><br><span class="line">kubectl delete rs &lt;rs_name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-3、RS的标签选择器"><a href="#4-3-3、RS的标签选择器" class="headerlink" title="4.3.3、RS的标签选择器"></a>4.3.3、RS的标签选择器</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030003412353.png" alt="image-20201030003412353" style="zoom:50%;" />

<h2 id="4-4、DaemonSet"><a href="#4-4、DaemonSet" class="headerlink" title="4.4、DaemonSet"></a>4.4、DaemonSet</h2><p>当你希望pod在集群中的每个节点上运行时，例如日志收集器和资源监控器 这些系统级别的守护进程时，可以使用DaemonSet。</p>
<p>在Kubernetes之外， 此类进程通常在节点启动期间通过系统初始化脚本或systemd守护进程启动。 在Kubernetes 节点上，仍然可以使用systemd运行系统进程，但这样就不能利用所有的Kubernetes特性了。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030004023802.png" alt="image-20201030004023802" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030004113919.png" alt="image-20201030004113919" style="zoom:50%;" />

<h2 id="4-5、Job"><a href="#4-5、Job" class="headerlink" title="4.5、Job"></a>4.5、Job</h2><p>Job允许你运行一 种 pod, 该 pod 在内部进程成功结束时， 不重启容器。 一旦任务完成， pod 就被认为处千完成状态。</p>
<p>在发生节点故障时，该节点上由 Job 管理的 pod 将按照 ReplicaSet 的 pod 的方式， 重新安排到其他节点。 如果进程本身异常退出(进程返回错误退出代码时)， 可以 将 Job 配置为重新启动容器。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030004335504.png" alt="image-20201030004335504" style="zoom:50%;" />

<p>在一 个pod的定义中， 可以指定在容器中运行的进程结束时，Kubemetes会做什么。 这是通过pod配置的属性restartPo巨cy完成的， 默认为Always。 Job pod不能使用默认策略， 因 为它们不是要无限期地运行 。 因此， 需要明确地将重启 策略设置为OnFailure 或Never。 此设置防止容器在完成任务时重新启动。</p>
<h3 id="4-5-1、在Job中运行多个Pod实例"><a href="#4-5-1、在Job中运行多个Pod实例" class="headerlink" title="4.5.1、在Job中运行多个Pod实例"></a>4.5.1、在Job中运行多个Pod实例</h3><p>作业可以配置为创建多个pod实例， 并以并行或串行方式运行 它们 。 这是通过 在Job配置中设置 completions和parallelism属性来完成的。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030004806213.png" alt="image-20201030004806213" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030004857901.png" alt="image-20201030004857901" style="zoom:50%;" />

<p>你甚至可以在 Job 运行时更改 Job 的 paralle辽sm 属性。 这与缩放 ReplicaSet 或 ReplicationController 类似， 可以使用 kubectl scale 命令完成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale job job_name --replicas 3</span><br></pre></td></tr></table></figure>
<p>通过在 pod 配置中设置 activeDeadlineSeconds 属性，可以限制 pod 的时间。 如果 pod 运行时间超过此时间， 系统将尝试终止 pod, 并将 Job 标记为失败。</p>
<blockquote>
<p>注意：通过指定 Job manifest 中的 spec.backoffLimit 字段， 可以配置 Job 在被标记为失败之前可以重试的次数。 如果你没有明确指定它， 则默认为6。</p>
</blockquote>
<h2 id="4-6、CronJob"><a href="#4-6、CronJob" class="headerlink" title="4.6、CronJob"></a>4.6、CronJob</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030005255378.png" alt="image-20201030005255378" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030005417184.png" alt="image-20201030005417184" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030005525078.png" alt="image-20201030005525078" style="zoom:50%;" />

<h1 id="5、服务：让客户端发现Pod并与之通信"><a href="#5、服务：让客户端发现Pod并与之通信" class="headerlink" title="5、服务：让客户端发现Pod并与之通信"></a>5、服务：让客户端发现Pod并与之通信</h1><h2 id="5-1、介绍服务"><a href="#5-1、介绍服务" class="headerlink" title="5.1、介绍服务"></a>5.1、介绍服务</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030015151075.png" alt="image-20201030015151075" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030015401789.png" alt="image-20201030015401789" style="zoom:50%;" />

<h3 id="5-1-1、创建服务"><a href="#5-1-1、创建服务" class="headerlink" title="5.1.1、创建服务"></a>5.1.1、创建服务</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030015536158.png" alt="image-20201030015536158" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 kubectl expose 创建服务</span></span><br><span class="line">kubectl expose rc kubia --type=LoadBalancer --name kubia-http</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030015847091.png" alt="image-20201030015847091" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检查新的服务</span></span><br><span class="line">kubectl get svc</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030020154728.png" alt="image-20201030020154728" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在容器中执行命令</span></span><br><span class="line">kubectl exec kubia-7nogl -- curl -s http: //svc_ip</span><br></pre></td></tr></table></figure>
<blockquote>
<p>双横杠(–)代表着kubectl命令项的结束。 在两个横杠之后的内容是指 在pod内部需要执行的命令</p>
</blockquote>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030020445120.png" alt="image-20201030020445120" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030020612610.png" alt="image-20201030020612610" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030020707093.png" alt="image-20201030020707093" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030020925003.png" alt="image-20201030020925003" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: vl </span><br><span class="line">kind: Service </span><br><span class="line">metadata:</span><br><span class="line">  name: kubia </span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80 </span><br><span class="line">    targetPort: 8080</span><br><span class="line">  - name: https</span><br><span class="line">    port: 443 </span><br><span class="line">    targetPort: 8443</span><br><span class="line">  selector:     #（标签选择器应用于整个服务）</span><br><span class="line">    app: kubia</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030021214804.png" alt="image-20201030021214804" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030021351307.png" alt="image-20201030021351307" style="zoom:50%;" />

<h3 id="5-1-2、服务发现"><a href="#5-1-2、服务发现" class="headerlink" title="5.1.2、服务发现"></a>5.1.2、服务发现</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030153025655.png" alt="image-20201030153025655" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030153711897.png" alt="image-20201030153711897" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030153821813.png" alt="image-20201030153821813" style="zoom:50%;" />

<p>​                每个服务从内部DNS服务器中获得一个DNS条目，客户端的Pod在知道服务名称的情况下可以通过全限定域名（FQDN）来访问。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030154059858.png" alt="image-20201030154059858" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在Pod中运行shell</span></span><br><span class="line">kubectl exec -it &lt;podName&gt; -c &lt;containerName&gt; -n &lt;namespace&gt; -- shell comand</span><br><span class="line">kubectl exec -it pod_name bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 访问服务</span></span><br><span class="line">curl http://kubia.default.svc.cluster.local</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：服务的IP是虚拟IP，并且只有在与服务端口结合时才有意义。因此服务的IP 一般是ping 不通的</p>
</blockquote>
<h2 id="5-2、连接到集群外部的服务"><a href="#5-2、连接到集群外部的服务" class="headerlink" title="5.2、连接到集群外部的服务"></a>5.2、连接到集群外部的服务</h2><p>不要让服务将连接重定向到集群中的Pod，而是让它重定向到外部IP和端口。</p>
<h3 id="5-2-1、介绍服务endpoint"><a href="#5-2-1、介绍服务endpoint" class="headerlink" title="5.2.1、介绍服务endpoint"></a>5.2.1、介绍服务endpoint</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030162935708.png" alt="image-20201030162935708" style="zoom:50%;" />

<h3 id="5-2-2、手动配置服务的endpoint"><a href="#5-2-2、手动配置服务的endpoint" class="headerlink" title="5.2.2、手动配置服务的endpoint"></a>5.2.2、手动配置服务的endpoint</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163120804.png" alt="image-20201030163120804" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163150586.png" alt="image-20201030163150586" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163308001.png" alt="image-20201030163308001" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163327787.png" alt="image-20201030163327787" style="zoom:50%;" />

<h3 id="5-2-3、为外部服务创建别名"><a href="#5-2-3、为外部服务创建别名" class="headerlink" title="5.2.3、为外部服务创建别名"></a>5.2.3、为外部服务创建别名</h3><p>除了手动配置服务的Endpoint来代替公开外部服务方法，有 一 种更简单的方法， 就是通过其完全限定域名(FQDN)访问外部服务。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163554518.png" alt="image-20201030163554518" style="zoom:50%;" />

<p>ExternalName服务仅在DNS级别实施一为服务创建了简单的CNAME DNS记录。 因此，连接到服务的客户端将直接连接到外部服务， 完全绕过服务代理。 出于这个原因， 这些类型的服务甚至不会获得集群IP。</p>
<blockquote>
<p>注意CNAME记录指向完全限定的域名而不是数字 IP地址</p>
</blockquote>
<h2 id="5-3、将服务暴露给外部客户端"><a href="#5-3、将服务暴露给外部客户端" class="headerlink" title="5.3、将服务暴露给外部客户端"></a>5.3、将服务暴露给外部客户端</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030163952250.png" alt="image-20201030163952250" style="zoom:50%;" />

<h3 id="5-3-1、NodePort"><a href="#5-3-1、NodePort" class="headerlink" title="5.3.1、NodePort"></a>5.3.1、NodePort</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164152629.png" alt="image-20201030164152629" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164239225.png" alt="image-20201030164239225" style="zoom:50%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl get svc kubia-nodeport</span></span><br><span class="line">NAME           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubia-nodeport 10.111.254.223  &lt;nodes&gt;       80:30123/TCP   2m</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164608532.png" alt="image-20201030164608532" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164634556.png" alt="image-20201030164634556" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164735532.png" alt="image-20201030164735532" style="zoom:50%;" />

<h3 id="5-3-2、通过负载均衡暴露服务"><a href="#5-3-2、通过负载均衡暴露服务" class="headerlink" title="5.3.2、通过负载均衡暴露服务"></a>5.3.2、通过负载均衡暴露服务</h3><p>在云提供商上运行的Kubernetes集群通常支持从云基础架构自动提供负载平衡 器。 所有需要做的就是设置服务的类型为Load Badancer而不是NodePort。 负载均衡器拥有自己独 一 无二的可公开访问的 IP 地址， 并将所有连接重定向到服务。 可以通过负载均衡器的 IP 地址访问服务。</p>
<p>如果Kubemetes在不支 持Load Badancer服 务的环境中运行， 则不会调配负载平衡器，但该服务仍将表现得像 一 个NodePort服 务。 这是因为Load Badancer服务是NodePort服务的扩展。</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030164923846.png" alt="image-20201030164923846" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030165029434.png" alt="image-20201030165029434" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030165233694.png" alt="image-20201030165233694" style="zoom:50%;" />

<h3 id="5-3-3、了解外部服务的特性"><a href="#5-3-3、了解外部服务的特性" class="headerlink" title="5.3.3、了解外部服务的特性"></a>5.3.3、了解外部服务的特性</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170142898.png" alt="image-20201030170142898" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170313894.png" alt="image-20201030170313894" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170404458.png" alt="image-20201030170404458" style="zoom:50%;" />

<h2 id="5-4、通过Ingress暴露服务"><a href="#5-4、通过Ingress暴露服务" class="headerlink" title="5.4、通过Ingress暴露服务"></a>5.4、通过Ingress暴露服务</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170550404.png" alt="image-20201030170550404" style="zoom:50%;" />

<h3 id="5-4-1、创建Ingress资源"><a href="#5-4-1、创建Ingress资源" class="headerlink" title="5.4.1、创建Ingress资源"></a>5.4.1、创建Ingress资源</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170743332.png" alt="image-20201030170743332" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170842356.png" alt="image-20201030170842356" style="zoom:50%;" />

<h3 id="5-4-2、通过-Ingress-访问服务"><a href="#5-4-2、通过-Ingress-访问服务" class="headerlink" title="5.4.2、通过 Ingress 访问服务"></a>5.4.2、通过 Ingress 访问服务</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030170955105.png" alt="image-20201030170955105" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030171024890.png" alt="image-20201030171024890" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030171138908.png" alt="image-20201030171138908" style="zoom:50%;" />

<h3 id="5-4-3、通过相同的-Ingress-暴露多个服务"><a href="#5-4-3、通过相同的-Ingress-暴露多个服务" class="headerlink" title="5.4.3、通过相同的 Ingress 暴露多个服务"></a>5.4.3、通过相同的 Ingress 暴露多个服务</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030171249164.png" alt="image-20201030171249164" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201030171322995.png" alt="image-20201030171322995" style="zoom:50%;" />

<h3 id="5-4-4、配置-Ingress处理TLS传输"><a href="#5-4-4、配置-Ingress处理TLS传输" class="headerlink" title="5.4.4、配置 Ingress处理TLS传输"></a>5.4.4、配置 Ingress处理TLS传输</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031150554314.png" alt="image-20201031150554314" style="zoom:50%;" />

<blockquote>
<p>注：TLS传输数据时，用私钥（tls.key）对数据加密，用证书（tls.cert）对数据解密</p>
</blockquote>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031154437696.png" alt="image-20201031154437696" style="zoom:50%;" />

<h2 id="5-5、就绪指针"><a href="#5-5、就绪指针" class="headerlink" title="5.5、就绪指针"></a>5.5、就绪指针</h2><h3 id="5-5-1、介绍就绪探针"><a href="#5-5-1、介绍就绪探针" class="headerlink" title="5.5.1、介绍就绪探针"></a>5.5.1、介绍就绪探针</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031154621520.png" alt="image-20201031154621520" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031154722878.png" alt="image-20201031154722878" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031154747963.png" alt="image-20201031154747963" style="zoom:50%;" />

<h3 id="5-5-2、向Pod添加就绪探针"><a href="#5-5-2、向Pod添加就绪探针" class="headerlink" title="5.5.2、向Pod添加就绪探针"></a>5.5.2、向Pod添加就绪探针</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改现有rc模板</span></span><br><span class="line">kubectl edit rc kubia</span><br></pre></td></tr></table></figure>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031155005359.png" alt="image-20201031155005359" style="zoom:50%;" />

<h2 id="5-6、使用handless服务来发现独立的Pod"><a href="#5-6、使用handless服务来发现独立的Pod" class="headerlink" title="5.6、使用handless服务来发现独立的Pod"></a>5.6、使用handless服务来发现独立的Pod</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031155355706.png" alt="image-20201031155355706" style="zoom:50%;" />

<h3 id="5-6-1、创建handless服务"><a href="#5-6-1、创建handless服务" class="headerlink" title="5.6.1、创建handless服务"></a>5.6.1、创建handless服务</h3><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031155608493.png" alt="image-20201031155608493" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031155751298.png" alt="image-20201031155751298" style="zoom:50%;" />

<h2 id="5-7、排除服务故障"><a href="#5-7、排除服务故障" class="headerlink" title="5.7、排除服务故障"></a>5.7、排除服务故障</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031160024117.png" alt="image-20201031160024117" style="zoom:50%;" />

<h2 id="5-8、本章小结"><a href="#5-8、本章小结" class="headerlink" title="5.8、本章小结"></a>5.8、本章小结</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20201031160210279.png" alt="image-20201031160210279" style="zoom:50%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/09/19/python/python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C14~18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/09/19/python/python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C14~18/" class="post-title-link" itemprop="url">Python学习手册14</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-19 17:33:43" itemprop="dateCreated datePublished" datetime="2020-09-19T17:33:43+08:00">2020-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 00:09:35" itemprop="dateModified" datetime="2021-01-14T00:09:35+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="14、函数基础"><a href="#14、函数基础" class="headerlink" title="14、函数基础"></a>14、函数基础</h1><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000538642.png" alt="image-20210114000538642" style="zoom:50%;" />

<p>函数的两个作用：</p>
<ul>
<li>最大化代码重用和最小化代码冗余</li>
<li>过程的分解</li>
</ul>
<h2 id="编写函数"><a href="#编写函数" class="headerlink" title="编写函数"></a>编写函数</h2><p>一些主要的概念介绍：</p>
<ul>
<li>def 是可执行的代码：def是一个可执行的语句，在Python运行def前，函数实际不存在</li>
<li>def 创建了一个对象并将其赋值给某一变量名</li>
<li>lambda 创建一个对象并将其作为结果返回</li>
<li>return 将一个结果对象传回给调用者：没有返回值的return 语句返回 None</li>
<li>yield 向调用者发回一个结果对象，但是会记住它离开的位置</li>
<li>global 声明了一个模块级的可被赋值的变量</li>
<li>nonlocal 声明了一个需要被赋值的外层函数变量：nonlocal 语句允许一个函数对一个在其外层的def 语句作用域中已有的名称进行赋值</li>
<li>参数是通过赋值（对象引用）传递给函数的：Python的模型中，调用者和函数通过引用共享对象，但是不需要别名。</li>
<li>实参默认按位置赋值给形参</li>
<li>参数、返回值与变量不需要被声明：如同Python中的所有对象一样，函数并没有类型约束。你可以传递任意类型的参数给函数，函数也可以返回任意类型的对象</li>
</ul>
<h2 id="Python中的多态"><a href="#Python中的多态" class="headerlink" title="Python中的多态"></a>Python中的多态</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">times</span>(<span class="params">x,y</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*y</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>times(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>times(<span class="string">&quot;NiP&quot;</span>,<span class="number">4</span>)</span><br><span class="line"><span class="string">&#x27;NiPNiPNiPNiP&#x27;</span></span><br></pre></td></tr></table></figure>
<p>上述函数，在处理数字时，<code>*</code> 代表乘法，在处理字符串时，<code>*</code> 代表重复。 Python把对某一对象在某种语法下的合理性交给那个对象自身来判断。 <code>*</code> 作为一个分派机制，将执行的控制权移交给被处理的对象。</p>
<p>这种依赖类型的行为称为多态。其含义就是 <strong>一个操作的意义取决于被操作对象的类型</strong>。</p>
<p>对于函数内部定义好的逻辑而言，如果传入的对象不支持内部的运算符（即不支持这种预期的接口），那么Python将会在 <code>*</code> 表达式运行时检测到错误，并自动抛出一个异常。</p>
<p>如果检查传入函数的类型，实质上破坏了函数的灵活性，并把函数限制在了特定的类型上。没有这类检查时，函数可以处理更大范围的类型：任何支持函数所预期的接口的对象都将适用（接口一词是指：函数所执行的一组方法和表达式运算符）</p>
<blockquote>
<p>这种多态性近年也被称为鸭子类型：其核心思想是，你的代码不必在意一个对象是不是只鸭子，只需要它能向鸭子那样叫就行了。同时鸭子叫 的实现留给对象自己完成</p>
</blockquote>
<h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">intersect</span>(<span class="params">seq1,seq2</span>):</span></span><br><span class="line">    res=[]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seq1:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> seq2:</span><br><span class="line">            res.append[x]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>所有在函数内部进行赋值的变量都是局部变量：</p>
<ul>
<li>res 被赋过值，所以是局部变量</li>
<li>参数是通过赋值传入的，所以 seq1 和 seq2 是局部变量</li>
<li>for 循环将元素赋值给了变量 x，所以 x 也是局部变量</li>
</ul>
<p>所有的局部变量会在函数调用时出现，并在函数退出时消失。尽管intersect 函数末尾的return 语句返回了结果对象，但是变量res 却消失了</p>
<h1 id="15、作用域"><a href="#15、作用域" class="headerlink" title="15、作用域"></a>15、作用域</h1><p>Python作用域，即变量定义和查找的地方。如模块文件一样，作用域能够阻止程序代码中的名称冲突。</p>
<h2 id="作用域基础"><a href="#作用域基础" class="headerlink" title="作用域基础"></a>作用域基础</h2><p>Python创建、修改或查找变量名时都是在所谓的命名空间（变量名存在的地方）中进行的。作用域这个术语指的就是命名空间。</p>
<p>Python中一切与变量名有关的事件（包括作用域的分类），都发生在赋值的时候。由于变量最初没有声明，Python将一个变量名被赋值的地点关联为（绑定给）一个特定的命名空间。换句话说，在代码中给一个变量赋值的位置决定了这个变量存在于哪个命名空间，即它的可见范围。</p>
<p>变量可以在3个不同的地方被赋值，分别对应于3种不同的作用域：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">X = <span class="number">99</span>   <span class="comment"># 全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    X = <span class="number">88</span>  <span class="comment"># 非局部作用域</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nested</span>():</span></span><br><span class="line">        x = <span class="number">77</span>  <span class="comment"># 局部作用域</span></span><br><span class="line">    <span class="keyword">return</span> nested()</span><br><span class="line"></span><br><span class="line">Y = <span class="built_in">list</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]   <span class="comment"># list这个变量属于 内部作用域</span></span><br></pre></td></tr></table></figure>
<h2 id="作用域细节"><a href="#作用域细节" class="headerlink" title="作用域细节"></a>作用域细节</h2><p>一般而言，函数定义了局部作用域，模块文件定义了全局作用域。作用域的属性有：</p>
<ul>
<li><p>外围模块是全局作用域：</p>
<p>每个模块都是一个全局作用域。模块被导入后，该模块的全局变量就变成了该模块的属性</p>
</li>
<li><p>全局作用域的作用范围仅限于单个文件</p>
<p>这里的全局指的是在一个文件的顶层的变量名仅对这个文件的代码才是全局的。Python中是没有一个跨文件的单一且无所不包的全局作用概念的</p>
</li>
<li><p>函数赋值的变量名称除非被声明为global 或 nonlocal，否则均为局部变量</p>
</li>
<li><p>函数内未定义的变量都是外层函数的局部变量、全局变量或内置变量</p>
</li>
<li><p>函数的每次调用都会创建一个新的局部作用域</p>
</li>
<li><p>交互式命令行是一个名为<code>__main__</code>的模块，它可以打印结果，但不会保存其代码；不过在其他方面，它与模块文件的顶层相同</p>
</li>
</ul>
<p>注意：一个函数内部任何类型的赋值都会把一个名称划定为局部的，这包括：</p>
<ul>
<li>=语句</li>
<li>import中的模块名</li>
<li>def中的函数名</li>
<li>函数形式参数名</li>
</ul>
<p>另外要注意，函数内，原位置改变对象并不会把变量划分为局部变量（<code>L.append(x)</code>），实际上只有对象变量名赋值才可以（<code>L = X</code>），要明白修改一个对象并不是给一个变量名赋值</p>
<h2 id="变量名解析：LEGB规则"><a href="#变量名解析：LEGB规则" class="headerlink" title="变量名解析：LEGB规则"></a>变量名解析：LEGB规则</h2><p>对于函数中的变量：</p>
<ul>
<li>当你在函数中使用未限定（限定是指使用gloab、nonlocal）的变量名时，Python将查找四个作用域，并在第一次找到时停止查找。首先是局部作用域（L），其次是向外一层的def 或 lambda 的局部作用域（E），之后是全局作用域（G），最后是内置作用域（Buint-in）。如果变量名始终没有找到，则会报错</li>
<li>使用global，会让Python只查找 全局作用域 和 内置作用域</li>
<li>使用nonlocal，会让Python只查找 非局部作用域（E）</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000557226.png" alt="image-20210114000557226"></p>
<p>不过，这些规则仅对简单变量名生效，属性变量名（object.spam）存在于特定的对象中，并遵循一种完全不同的查找规则。</p>
<h2 id="其他的Python作用域"><a href="#其他的Python作用域" class="headerlink" title="其他的Python作用域"></a>其他的Python作用域</h2><p>从技术上，Python还有另外三种作用域，推导语法中的临时循环变量，try处理语句中的异常引用变量，class语句中的局部作用域。前两个是特殊情形，极少影响到真实代码，第三个遵循LEGB原则。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000605860.png" alt="image-20210114000605860"></p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200921165648352.png" alt="image-20200921165648352" style="zoom:50%;" />

<h2 id="内置作用域"><a href="#内置作用域" class="headerlink" title="内置作用域"></a>内置作用域</h2><p>3.x版本中，内置作用域是通过一个名为builtins 的标准库模块来实现的，但是这个变量名自身没有放入内置作用域内，所以必须导入这个文件才能使用它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> builtins</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>builtins.<span class="built_in">open</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">open</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">open</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">open</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">open</span> <span class="keyword">is</span> builtins.<span class="built_in">open</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000614466.png" alt="image-20210114000614466"></p>
<h2 id="程序化设计要点"><a href="#程序化设计要点" class="headerlink" title="程序化设计要点"></a>程序化设计要点</h2><ul>
<li><p>最小化全局变量</p>
</li>
<li><p>最小化跨文件修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#不优雅的方式</span></span><br><span class="line"><span class="comment">#first.py</span></span><br><span class="line">x = <span class="number">99</span></span><br><span class="line"><span class="comment">#second.py</span></span><br><span class="line"><span class="keyword">import</span> first</span><br><span class="line">print(first.x)</span><br><span class="line">first.x = <span class="number">88</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#优雅的方式</span></span><br><span class="line"><span class="comment">#first.py</span></span><br><span class="line">x = <span class="number">99</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setx</span>(<span class="params">new</span>):</span></span><br><span class="line">  <span class="keyword">global</span> x</span><br><span class="line">  x = new</span><br><span class="line">  </span><br><span class="line"><span class="comment">#second.py</span></span><br><span class="line">first.setx(<span class="number">88</span>)</span><br></pre></td></tr></table></figure>
<h2 id="访问全局变量的方式"><a href="#访问全局变量的方式" class="headerlink" title="访问全局变量的方式"></a>访问全局变量的方式</h2></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#thismod.oy</span></span><br><span class="line">var = <span class="number">99</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">glob1</span>():</span></span><br><span class="line">  <span class="keyword">global</span> var</span><br><span class="line">  var += <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">glob2</span>():</span></span><br><span class="line">  <span class="keyword">import</span> thismod</span><br><span class="line">  thismod.var += <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">glob3</span>():</span></span><br><span class="line">  <span class="keyword">import</span> sys</span><br><span class="line">  glob = sys.modules[<span class="string">&#x27;thismodel&#x27;</span>]</span><br><span class="line">  glob.var += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="嵌套函数与闭包"><a href="#嵌套函数与闭包" class="headerlink" title="嵌套函数与闭包"></a>嵌套函数与闭包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#嵌套函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">  x=<span class="number">88</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">    print(x)</span><br><span class="line">  <span class="keyword">return</span> f2()</span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line"><span class="comment">#闭包</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">  x=<span class="number">88</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f2</span>():</span></span><br><span class="line">    print(x)</span><br><span class="line">  <span class="keyword">return</span> f2</span><br><span class="line">f=f1()</span><br><span class="line">f()</span><br></pre></td></tr></table></figure>
<p>闭包（closure）也可以叫做工厂函数（factory function）——前者将其描述成一种函数技巧，后者认为它是一种设计模式。不论叫法如何，这里的关键是，函数对象能够记忆外层作用域里的值（状态记忆），而不管那些嵌套作用域是否还在内存中存在。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个简单的闭包</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maker</span>(<span class="params">N</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">action</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x ** N</span><br><span class="line">  <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = maker(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">3</span>)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g = maker(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>g(<span class="number">3</span>)</span><br><span class="line"><span class="number">27</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#lambda形式的闭包</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maker</span>(<span class="params">N</span>):</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">lambda</span> x:x**N</span><br></pre></td></tr></table></figure>
<p>通过对闭包的每次调用，都能得到属于调用自己的状态信息的集合。</p>
<h3 id="闭包-VS-类"><a href="#闭包-VS-类" class="headerlink" title="闭包 VS 类"></a>闭包 VS 类</h3><p>当需要功能完整的对象时，类是一个更好的实现状态记忆的选择，它们用属性赋值来更加显式地创建它们的内存。类也支持闭包函数所不支持的其他工具，如通过继承的定制化和运算符重载。</p>
<p>当记忆状态是唯一的目标时，闭包函数是一个更好的轻量级解决方案。</p>
<h2 id="Python函数记忆状态的方式"><a href="#Python函数记忆状态的方式" class="headerlink" title="Python函数记忆状态的方式"></a>Python函数记忆状态的方式</h2><p>除了类与闭包，从更广阔的角度看，Python函数在调用间记忆状态还有多种方式，包括全局变量、类实例中的属性、外层作用域中的引用、参数默认值和函数属性。</p>
<h3 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可有可无的 参数默认值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>():</span></span><br><span class="line">  x=<span class="number">88</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x=x</span>):</span>  <span class="comment">#使用默认值</span></span><br><span class="line">    print(x)</span><br><span class="line">  <span class="keyword">return</span> f2()</span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">  x=<span class="number">4</span></span><br><span class="line">  action=(<span class="keyword">lambda</span> n,x=x:x**n)</span><br><span class="line">  <span class="keyword">return</span> action</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一定要有的 参数默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#错误示范</span></span><br><span class="line"><span class="comment">#外层作用域的变量，在嵌套的函数被调用时才进行查找，因此 i 始终为4</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeActions</span>():</span></span><br><span class="line">  acts=[]</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    acts.append(<span class="keyword">lambda</span> x:i ** x)</span><br><span class="line">  <span class="keyword">return</span> acts</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts=makeActions()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts[<span class="number">0</span>](<span class="number">2</span>)</span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts[<span class="number">1</span>](<span class="number">2</span>)</span><br><span class="line"><span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#正确示范</span></span><br><span class="line"><span class="comment">#通过默认参数将值传入,默认参数的求值是嵌套函数创建时发生的，所以每一个函数记住了属于自己的i变量的值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeActions</span>():</span></span><br><span class="line">  acts=[]</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    acts.append(<span class="keyword">lambda</span> x, i=i: i ** x)</span><br><span class="line">  <span class="keyword">return</span> acts</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts=makeActions()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts[<span class="number">1</span>](<span class="number">2</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>acts[<span class="number">2</span>](<span class="number">2</span>)</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<h3 id="类实例的属性"><a href="#类实例的属性" class="headerlink" title="类实例的属性"></a>类实例的属性</h3><p>针对可变状态信息的另一种方式是使用带有属性的类，类的优势在于，类的每个实例都会得到状态信息的一个新副本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tester</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,start</span>):</span></span><br><span class="line">    self.state = start</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">nested</span>(<span class="params">self,label</span>):</span></span><br><span class="line">    print(label,self.state)</span><br><span class="line">    self.state += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="函数属性"><a href="#函数属性" class="headerlink" title="函数属性"></a>函数属性</h3><p>在3.x和2.x中通用的状态记忆备选项，函数属性（用户定义的直接附加给函数的名称）也能达到与nonlocal相同的效果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tester</span>(<span class="params">start</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">nested</span>(<span class="params">label</span>):</span></span><br><span class="line">    print(label,nested.state)</span><br><span class="line">    nested.state += <span class="number">1</span></span><br><span class="line">  nested.state = start</span><br><span class="line">  <span class="keyword">return</span> nested</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F = tester(<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F(<span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line">spam <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F(<span class="string">&#x27;ham&#x27;</span>)</span><br><span class="line">ham <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F.state</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="通过可变对象实现"><a href="#通过可变对象实现" class="headerlink" title="通过可变对象实现"></a>通过可变对象实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tester</span>(<span class="params">start</span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">nested</span>(<span class="params">label</span>):</span></span><br><span class="line">    print(label,state[<span class="number">0</span>])</span><br><span class="line">    state[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">  state = [start]</span><br><span class="line">  <span class="keyword">return</span> nested</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F=tester(<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F(<span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line">spam <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F(<span class="string">&#x27;ham&#x27;</span>)</span><br><span class="line">ham <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>这利用了列表的可变形，函数内修改原位置对象时，不会将其名称归类为局部。</p>
<h2 id="定制open"><a href="#定制open" class="headerlink" title="定制open"></a>定制open</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeopen</span>(<span class="params"><span class="built_in">id</span></span>):</span></span><br><span class="line">  orginal = builtins.<span class="built_in">open</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">custom</span>(<span class="params">*kargs, **pargs</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;Custom open call %r:&#x27;</span> % <span class="built_in">id</span>,kargs,pargs)</span><br><span class="line">    <span class="keyword">return</span> orginal(*kargs, **pargs)</span><br><span class="line">  builtins.<span class="built_in">open</span> = custom</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>makeopen(<span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F = <span class="built_in">open</span>(<span class="string">&#x27;/Users/shenshawn/tmp.py&#x27;</span>)</span><br><span class="line">Custom <span class="built_in">open</span> call <span class="string">&#x27;spam&#x27;</span>: (<span class="string">&#x27;/Users/shenshawn/tmp.py&#x27;</span>,) &#123;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment"># %r 与 %s 的区别就好比 repr() 函数处理对象与 str() 函数处理对象的差别</span></span><br></pre></td></tr></table></figure>
<h1 id="16、参数"><a href="#16、参数" class="headerlink" title="16、参数"></a>16、参数</h1><h2 id="参数传递基础"><a href="#参数传递基础" class="headerlink" title="参数传递基础"></a>参数传递基础</h2><ul>
<li><p>参数的传递是通过自动将对象赋值给局部变量名实现的</p>
<p>所有参数实际上都是通过指针传入的。作为参数被传递的对象从来不会自动赋值</p>
<ul>
<li>不可变参数本质上传入了“值”：像整数和字符串这样的对象是通过对象引用而不是复制传入的。但是你不可能在原位置修改对象，最终的效果就像创建了一份副本</li>
<li>可变对象本质上传入了“指针”</li>
</ul>
</li>
<li><p>在函数内部赋值参数名不会影响调用者</p>
</li>
<li><p>改变函数的可变参数的值也许会对调用者有影响</p>
</li>
</ul>
<h2 id="参数类型"><a href="#参数类型" class="headerlink" title="参数类型"></a>参数类型</h2><ul>
<li><p>位置参数：从左至右进行匹配</p>
</li>
<li><p>关键字参数：通过参数名进行匹配，即使用 name=value 这种语法</p>
</li>
<li><p>默认值参数：为没有传入值的可选参数指定参数值</p>
</li>
<li><p>可变长参数（Varargs）收集：收集任意多的基于位置（*）或关键字（**）的参数。</p>
<p>函数能够用一个星号“*” 或两个星号“**”开头的特殊参数，来收集任意多的额外参数。</p>
<p>*name形式：把多出来不能匹配的关键字参数收集到一个元组中</p>
<p>**name形式：把多出来不能匹配的关键字参数收集到一个字典中</p>
</li>
<li><p>可变长参数解包：收集任意多的基于位置（*）或关键字（**）的参数</p>
<p>调用者能用一个星号“*” 或两个星号“**”开头的语法，将参数集合解包成单个的参数</p>
</li>
<li><p>keyword-only参数：必须按照名称传递参数</p>
<p>在3.x中，函数也能用关键字参数来指定必须通过名称（而不是位置）来传递的参数。这样的参数通常用来定义实际使用的参数以外的配置选项</p>
</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000628179.png" alt="image-20210114000628179"></p>
<h2 id="参数顺序"><a href="#参数顺序" class="headerlink" title="参数顺序"></a>参数顺序</h2><p>如果使用并组合特殊参数匹配模式，则需要遵守如下顺序规则：</p>
<ul>
<li>在函数调用时，参数必须按此顺序出现：所有基于位置的参数（value），之后是所有关键字参数（name=value）和 *iterable形式的组合，之后是 **dict 的形式</li>
<li>在函数头部，参数必须按照此顺序出现：所有一般参数（name），之后是所有默认值参数（name=value），之后是 <em>name（或是3.x中的 * ）形式，之后是所有 name 或 name=value的keyword-only参数，之后是 *</em>name形式</li>
</ul>
<p>python在赋值前，匹配参数的步骤为：</p>
<ol>
<li>通过位置分配无关键字参数</li>
<li>通过匹配名称分配关键字参数</li>
<li>将剩下的非关键字参数分配到 *name 中</li>
<li>将剩下的关键字参数分配到 **name 中</li>
<li>把默认值分配给在头部未得到匹配的参数</li>
</ol>
<p>在此之后，Python会检查以确保每个参数只被传入了一个值，如果不是这样，将引发一个错误。当所有匹配完成后，Python再把传入的对象赋值给参数名称</p>
<blockquote>
<p>注意，将函数头部中的 *name 和 在 表达式赋值时的星号区分开</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这种*号创建列表而非元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x,*y=<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">a,*b,c=<span class="number">6</span>,**d</span>):</span></span><br><span class="line"><span class="meta">... </span>   print(a,b,c,d)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>,*(<span class="number">2</span>,<span class="number">3</span>),**<span class="built_in">dict</span>(x=<span class="number">4</span>,y=<span class="number">5</span>))</span><br><span class="line"><span class="number">1</span> (<span class="number">2</span>, <span class="number">3</span>) <span class="number">6</span> &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c</span>):</span>a=<span class="number">2</span>;b[<span class="number">0</span>]=<span class="string">&#x27;x&#x27;</span>;c[<span class="string">&#x27;a&#x27;</span>]=<span class="string">&#x27;y&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l=<span class="number">1</span>;m=[<span class="number">1</span>];n=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">0</span>&#125;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(l,m,n)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m</span><br><span class="line">[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n</span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;y&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">a,b,c=<span class="number">3</span>,d=<span class="number">4</span></span>):</span>print(a,b,c,d)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(<span class="number">1</span>,*(<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"><span class="number">1</span> <span class="number">5</span> <span class="number">6</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<h1 id="17、函数的高级话题"><a href="#17、函数的高级话题" class="headerlink" title="17、函数的高级话题"></a>17、函数的高级话题</h1><h2 id="函数设计概念"><a href="#函数设计概念" class="headerlink" title="函数设计概念"></a>函数设计概念</h2><ul>
<li>耦合性<ul>
<li>在输入时使用参数，在输出时使用return语句</li>
<li>只有在真正必要的情况下使用全局变量</li>
<li>不要改变可变类型的参数，除非调用者希望这样</li>
</ul>
</li>
<li>内聚性<ul>
<li>每一个函数都应该有一个单一的、统一的目标</li>
<li>每一个函数应相对较小</li>
<li>避免直接改变其他模块文件中的变量</li>
</ul>
</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000636280.png" alt="image-20210114000636280"></p>
<h2 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h2><p>递归允许程序遍历拥有任意的、不可预知构型和深度的结构。递归是简单循环和迭代的替代品，尽管它不一定是最简单或高效的一种。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用递归求和</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mysum</span>(<span class="params">L</span>):</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> L:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">return</span> L[<span class="number">0</span>] + mysum(L[<span class="number">1</span>:])</span><br><span class="line">  </span><br><span class="line"><span class="comment">#递归也可以是间接的</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mysum</span>(<span class="params">L</span>):</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> L: <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> nonempty(L)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nonempty</span>(<span class="params">L</span>):</span></span><br><span class="line">  <span class="keyword">return</span> L[<span class="number">0</span>] + mysum(L[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure>
<p>一般在确认迭代次数的前提下，while 循环、for循环的效率会更高。递归的优势在于处理简单循环无法处理的结构。</p>
<p>例子：计算一个嵌套的子列表结构中所有数字的总和：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,[<span class="number">2</span>,[<span class="number">3</span>,<span class="number">4</span>],<span class="number">5</span>],<span class="number">6</span>,[<span class="number">7</span>,<span class="number">8</span>]]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sumtree</span>(<span class="params">L</span>):</span></span><br><span class="line">  tot = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> x <span class="keyword">in</span> L:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x,<span class="built_in">list</span>):</span><br><span class="line">      tot += x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      tot += sumtree(x)</span><br><span class="line">  <span class="keyword">return</span> tot</span><br></pre></td></tr></table></figure>
<p>标准Python限制了运行时调用栈的深度来捕获无限递归的错误。为了扩大这一上限，可以使用sys模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getrecursionlimit()</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.setrecursionlimit(<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<h2 id="函数对象"><a href="#函数对象" class="headerlink" title="函数对象"></a>函数对象</h2><p>除了一般的调用函数的方法，我们还可以把函数对象存入数据结构中，就好像它们是整数或字符串一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schedule = [(echo,<span class="string">&#x27;Spam!&#x27;</span>),(echo,<span class="string">&#x27;Ham!&#x27;</span>)]</span><br><span class="line"><span class="keyword">for</span> (func,arg) <span class="keyword">in</span> schedule:</span><br><span class="line">  func(arg)</span><br></pre></td></tr></table></figure>
<p>我们还可以通用的检查函数的属性（函数自省）:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__name__</span><br><span class="line"><span class="string">&#x27;func&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__code__</span><br><span class="line">&lt;code <span class="built_in">object</span> func at <span class="number">0x10899a8a0</span>, file <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(func.__code__)</span><br><span class="line">[<span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>,...,<span class="string">&#x27;co_name&#x27;</span>, <span class="string">&#x27;co_names&#x27;</span>, <span class="string">&#x27;co_nlocals&#x27;</span>, <span class="string">&#x27;co_stacksize&#x27;</span>, <span class="string">&#x27;co_varnames&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__code__.co_varnames</span><br><span class="line">(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__code__.co_argcount</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>还可向函数附加任意的用户定义的属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>func</span><br><span class="line">&lt;function func at <span class="number">0x1089c57b8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.count=<span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.count+=<span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.count</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.handless=<span class="string">&quot;Spam&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.handless</span><br><span class="line"><span class="string">&#x27;Spam&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(func)</span><br><span class="line">[<span class="string">&#x27;__annotations__&#x27;</span>, ..., <span class="string">&#x27;count&#x27;</span>, <span class="string">&#x27;handless&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>这样的属性可以直接用来把状态信息附加到函数对象上，而不必使用全局、非局部和类等其他技术。和非局部不同，这样的属性可以从函数自身所在的任何地方被访问，甚至可以从其代码外部访问。</p>
<h2 id="3-x中的函数注解"><a href="#3-x中的函数注解" class="headerlink" title="3.x中的函数注解"></a>3.x中的函数注解</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000707652.png" alt="image-20210114000707652"  />

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a,b,c</span>):</span></span><br><span class="line">  <span class="keyword">return</span> a + b + c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a:<span class="string">&#x27;spam&#x27;</span>,b:(<span class="params"><span class="number">1</span>,<span class="number">10</span></span>),c:<span class="built_in">float</span></span>) -&gt; int:</span></span><br><span class="line">  <span class="keyword">return</span> a + b + c</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func.__annotations__</span><br><span class="line">&#123;&#x27;a&#x27;: &#x27;spam&#x27;, &#x27;b&#x27;: (1, 10), &#x27;c&#x27;: &lt;class &#x27;float&#x27;&gt;, &#x27;return&#x27;: &lt;class &#x27;int&#x27;&gt;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000728158.png" alt="image-20210114000728158"></p>
<h2 id="匿名函数-lambda"><a href="#匿名函数-lambda" class="headerlink" title="匿名函数:lambda"></a>匿名函数:lambda</h2><p>与def一样，lambda这个表达式创建了一个之后能够调用的函数，但是它返回该函数本身而不是将其赋值给一个变量名。这也是lambda有时称为匿名（没有函数名）的原因。实践中，它们常常以内联函数定义的形式出现，或者用作推迟一些代码的执行。</p>
<h3 id="lambda表达式基础："><a href="#lambda表达式基础：" class="headerlink" title="lambda表达式基础："></a>lambda表达式基础：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lambda argument1，argument2,...argument N:expresion using arguments</span><br></pre></td></tr></table></figure>
<p>lambda的特性在于：</p>
<ul>
<li><p>lambda是一个表达式，而不是语句</p>
<p>因为这一点，lambda可以出现在Python语法不允许def出现的地方，如列表生成式</p>
</li>
<li><p>lambda的主体是一个单独的表达式，而不是一个代码块</p>
</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000747290.png" alt="image-20210114000747290"></p>
<h2 id="函数式编程工具"><a href="#函数式编程工具" class="headerlink" title="函数式编程工具"></a>函数式编程工具</h2><p>今天的 Python 混合支持多种编程范式:过程式(使用基础的语句) ，面向对象式（使用类）和函数式。函数式编程的工具包括：</p>
<ul>
<li>map：在一个可迭代对象的各项上调用函数的工具</li>
<li>filter：使用一个测试函数在过滤项的工具</li>
<li>reduce：把函数作用在成对的项上来运行结果的工具</li>
<li>一等对象：即函数可以被作为对像一样使用</li>
<li>嵌套作用域闭包</li>
<li>匿名函数lambda</li>
<li>生成器和推导语法</li>
<li>函数装饰器和修饰器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#map</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>counters = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">inc</span>(<span class="params">x</span>):</span><span class="keyword">return</span> x+<span class="number">10</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(inc,counters))</span><br><span class="line">[<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">pow</span>,[<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">2</span>,<span class="number">5</span>,<span class="number">7</span>]))</span><br><span class="line">[<span class="number">1</span>, <span class="number">243</span>, <span class="number">16384</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#filter</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">filter</span>((<span class="keyword">lambda</span> x:x&gt;<span class="number">0</span>),<span class="built_in">range</span>(-<span class="number">5</span>,<span class="number">5</span>)))</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#reduce</span></span><br><span class="line"><span class="comment">#每一步，reduce将当前的和或乘积以及列表中的下一个元素传给列出的Lambda函数</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce((<span class="keyword">lambda</span> x,y:x+y),[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<h1 id="18、推导和生成"><a href="#18、推导和生成" class="headerlink" title="18、推导和生成"></a>18、推导和生成</h1><h2 id="列表推导"><a href="#列表推导" class="headerlink" title="列表推导"></a>列表推导</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[expression <span class="keyword">for</span> target <span class="keyword">in</span> iterable]</span><br><span class="line"></span><br><span class="line">[expression <span class="keyword">for</span> target1 <span class="keyword">in</span> iterable <span class="keyword">if</span> condition1</span><br><span class="line">            <span class="keyword">for</span> target1 <span class="keyword">in</span> iterable <span class="keyword">if</span> condition2 ...</span><br><span class="line">            <span class="keyword">for</span> target1 <span class="keyword">in</span> iterable <span class="keyword">if</span> conditionN]</span><br></pre></td></tr></table></figure>
<p>列表推导能实现的，一般也能通过map 和 filter 实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line"><span class="built_in">list</span>( <span class="built_in">map</span>((<span class="keyword">lambda</span> x: x**<span class="number">2</span>),<span class="built_in">filter</span>((<span class="keyword">lambda</span> x:x%<span class="number">2</span>==<span class="number">0</span>),<span class="built_in">range</span>(<span class="number">10</span>))))</span><br></pre></td></tr></table></figure>
<h2 id="生成器函数与表达式"><a href="#生成器函数与表达式" class="headerlink" title="生成器函数与表达式"></a>生成器函数与表达式</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000801191.png" alt="image-20210114000801191"></p>
<p>二者都不会一次性地创建一个列表，它们节省了内存空间，并且允许计算时间分摊到各此结果请求上。</p>
<h3 id="生成器函数：yield-vs-return"><a href="#生成器函数：yield-vs-return" class="headerlink" title="生成器函数：yield vs return"></a>生成器函数：yield vs return</h3><p>生成器函数创建时，它们被特殊地编译成一个支持选代协议的对象。井且在调用的时候它们不会返回一个结果：它们返回一个可以出现在任何迭代上下文中的结果生成器。这个生成器对象支持用一个自动创建的名为<code>__next__</code>的方法接口，来开始恢复或执行。</p>
<p>和返回一个值并退出的函数不同，生成器函数能够自动挂起并在生成值的时刻 恢复之前的状态（代码位置和整个局部作用域）并继续函数的执行。生成器函数产生（yield）一个值，而不是返回（return）一个值。yield语句会挂起该函数并向调用者返回一个值，但同时保留了足够的状态使函数能从它离开的地方继续。</p>
<p>生成器函数也可以有一条return语句，不过总是出现在def语句的末尾，用于终止值的生成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gensquares</span>(<span class="params">N</span>):</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">    <span class="keyword">yield</span> i ** <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>生成器函数，自身既是可迭代对象，又是迭代器，且只支持单次扫描</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = gensquares(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">iter</span>(y) <span class="keyword">is</span> y</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(y)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="扩展生成器函数协议：send-vs-next"><a href="#扩展生成器函数协议：send-vs-next" class="headerlink" title="扩展生成器函数协议：send vs next"></a>扩展生成器函数协议：send vs next</h3><p>send的作用是为yield赋值后，在调用一次<code>__next__</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">dog</span>(<span class="params">name</span>):</span></span><br><span class="line"><span class="meta">... </span>  print(<span class="string">&quot;&#123;&#125;开吃&quot;</span>.<span class="built_in">format</span>(name))</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    food = <span class="keyword">yield</span></span><br><span class="line"><span class="meta">... </span>    print(<span class="string">&quot;狗狗&#123;&#125;吃了:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(name,food))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dh = dog(<span class="string">&#x27;shawn&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(dh)</span><br><span class="line">shawn开吃</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(dh)</span><br><span class="line">狗狗shawn吃了:<span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(dh)</span><br><span class="line">狗狗shawn吃了:<span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dh.send(<span class="string">&#x27;骨头&#x27;</span>)</span><br><span class="line">狗狗shawn吃了:骨头</span><br></pre></td></tr></table></figure>
<p>yield是一个表达式的形式，它的值可通过两种方式调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> X</span><br><span class="line"></span><br><span class="line">A = (<span class="keyword">yield</span> X)</span><br><span class="line">X = (<span class="keyword">yield</span> Y) + <span class="number">42</span></span><br></pre></td></tr></table></figure>
<p>采用send方法可以编写一个能够被它的调用者终止的生成器，或是一个能够被重新定位内部处理的数据的生成器。</p>
<h3 id="生成器表达式"><a href="#生成器表达式" class="headerlink" title="生成器表达式"></a>生成器表达式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>生成器表达式可以出现任何迭代上下文中，就像生成器函数调用的结果那样。</p>
<p>生成器表达式通常等效于3.x版本中的map调用，因为它们都是按需生成元素。</p>
<p>生成器表达式也支持所有常见列表推导的语法——包括与之前遇到的filter函数调用类似的if 分句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#filter在3.x版本中是一个可迭代对象</span></span><br><span class="line">line = <span class="string">&#x27;aa bb c&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.join(x <span class="keyword">for</span> x <span class="keyword">in</span> line.split() <span class="keyword">if</span> <span class="built_in">len</span>(x) &gt; <span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.join(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x)&gt;<span class="number">1</span>, line.split()))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="生成器函数-VS-生成器表达式"><a href="#生成器函数-VS-生成器表达式" class="headerlink" title="生成器函数 VS 生成器表达式"></a>生成器函数 VS 生成器表达式</h3><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000810838.png" alt="image-20210114000810838"></p>
<h2 id="生成器是单遍迭代对象"><a href="#生成器是单遍迭代对象" class="headerlink" title="生成器是单遍迭代对象"></a>生成器是单遍迭代对象</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000817800.png" alt="image-20210114000817800" style="zoom:50%;" />

<p>内置类型支持多个迭代器与多次迭代，并且在活跃迭代器中传递，并反应它们的原位置修改</p>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000848054.png" alt="image-20210114000848054" style="zoom:50%;" />

<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><h3 id="生成器和迭代器的关系"><a href="#生成器和迭代器的关系" class="headerlink" title="生成器和迭代器的关系"></a>生成器和迭代器的关系</h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000900403.png" alt="image-20210114000900403" style="zoom:50%;" />

<h3 id="yield语句是做什么的"><a href="#yield语句是做什么的" class="headerlink" title="yield语句是做什么的"></a>yield语句是做什么的</h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000911088.png" alt="image-20210114000911088" style="zoom:50%;" />

<h3 id="map调用和列表推导的关系"><a href="#map调用和列表推导的关系" class="headerlink" title="map调用和列表推导的关系"></a>map调用和列表推导的关系</h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000924399.png" alt="image-20210114000924399" style="zoom:50%;" />


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/09/18/python/Python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C10%EF%BD%9E13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/09/18/python/Python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C10%EF%BD%9E13/" class="post-title-link" itemprop="url">Python学习手册10～13</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-18 15:35:47" itemprop="dateCreated datePublished" datetime="2020-09-18T15:35:47+08:00">2020-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 00:04:01" itemprop="dateModified" datetime="2021-01-14T00:04:01+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="10、if测试和语法规则"><a href="#10、if测试和语法规则" class="headerlink" title="10、if测试和语法规则"></a>10、if测试和语法规则</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一般形式</span></span><br><span class="line"><span class="keyword">if</span> test1:</span><br><span class="line">	statements1</span><br><span class="line"><span class="keyword">elif</span> test2:</span><br><span class="line">	statements2</span><br><span class="line"><span class="keyword">else</span> test3:</span><br><span class="line">	statements3</span><br><span class="line">  </span><br><span class="line"><span class="comment">#三元表达式</span></span><br><span class="line">A = Y <span class="keyword">if</span> X <span class="keyword">else</span> Z</span><br></pre></td></tr></table></figure>
<p><strong>字典多路式分支</strong></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000229030.png" alt="image-20210114000229030"></p>
<h2 id="真值和布尔测试"><a href="#真值和布尔测试" class="headerlink" title="真值和布尔测试"></a>真值和布尔测试</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000302490.png" alt="image-20210114000302490"></p>
<p>注意倒数第二条：<strong>布尔 and 和 or 运算符会返回真或假的操作数对象</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> <span class="keyword">or</span> <span class="number">3</span>,<span class="number">3</span> <span class="keyword">or</span> <span class="number">2</span></span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> <span class="keyword">or</span> []</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[] <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> <span class="keyword">and</span> <span class="number">3</span>,<span class="number">3</span> <span class="keyword">and</span> <span class="number">2</span></span><br><span class="line">(<span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">3</span> <span class="keyword">and</span> []</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[] <span class="keyword">and</span> &#123;&#125;</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>
<p><strong>布尔运算符的常见用法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过or从一组对象中做选择</span></span><br><span class="line">X = A <span class="keyword">or</span> B <span class="keyword">or</span> C <span class="keyword">or</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p><strong>any()和all()</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#any 检查集合中的元素是否有真</span></span><br><span class="line"><span class="comment">#all 检查集合中的元素是否全为真</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L</span><br><span class="line">[<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">any</span>(L)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">all</span>(L)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h1 id="11、while循环和for循环"><a href="#11、while循环和for循环" class="headerlink" title="11、while循环和for循环"></a>11、while循环和for循环</h1><h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	一般形式</span></span><br><span class="line"><span class="keyword">while</span> true:</span><br><span class="line">	statements</span><br><span class="line">	<span class="keyword">if</span> test:<span class="keyword">break</span>    <span class="comment"># break执行后，else语句不会执行</span></span><br><span class="line">	<span class="keyword">if</span> test:<span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	statements</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 模仿do until</span></span><br><span class="line"><span class="keyword">while</span> true:</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> exitTest():<span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> target <span class="keyword">in</span> <span class="built_in">object</span>:</span><br><span class="line">	statements</span><br><span class="line">  <span class="keyword">if</span> test:<span class="keyword">break</span>    <span class="comment"># break执行后，else语句不会执行</span></span><br><span class="line">	<span class="keyword">if</span> test:<span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	statements</span><br></pre></td></tr></table></figure>


<p><strong>3.x中的扩展序列赋值</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> (a,*b,c) <span class="keyword">in</span> [[<span class="number">1</span>,[<span class="number">2</span>,<span class="number">3</span>],<span class="number">4</span>],[<span class="number">5</span>,[<span class="number">6</span>,<span class="number">7</span>],<span class="number">8</span>]]:</span><br><span class="line"><span class="meta">... </span>    print(a,b,c)</span><br><span class="line">...</span><br><span class="line"><span class="number">1</span> [[<span class="number">2</span>, <span class="number">3</span>]] <span class="number">4</span></span><br><span class="line"><span class="number">5</span> [[<span class="number">6</span>, <span class="number">7</span>]] <span class="number">8</span></span><br></pre></td></tr></table></figure>


<p><strong>for循环读取文件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一次性将文件加载到内存</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>).readlines():</span><br><span class="line">	print(line.rstrip())</span><br><span class="line"><span class="comment"># 文件迭代器</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;test.txt&#x27;</span>):</span><br><span class="line">	print(line.rstrip())</span><br></pre></td></tr></table></figure>
<h2 id="编写for循环的技巧"><a href="#编写for循环的技巧" class="headerlink" title="编写for循环的技巧"></a>编写for循环的技巧</h2><p>熟练使用 range，zip，enumerate</p>
<p><strong>range</strong></p>
<p><code>range</code> 返回一系列连续增加的整数，可作为for中的索引</p>
<p>2.x中range 会返回一个完整的列表，3.x中range 会返回一个迭代器</p>
<p><strong>zip</strong></p>
<p><code>zip</code> 返回一系列并行元素的元组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L1=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L2=[<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">zip</span>(L1,L2))</span><br><span class="line">[(<span class="number">1</span>, <span class="number">5</span>), (<span class="number">2</span>, <span class="number">6</span>), (<span class="number">3</span>, <span class="number">7</span>), (<span class="number">4</span>, <span class="number">8</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>(<span class="built_in">zip</span>(L1,L2))</span><br><span class="line">&#123;<span class="number">1</span>: <span class="number">5</span>, <span class="number">2</span>: <span class="number">6</span>, <span class="number">3</span>: <span class="number">7</span>, <span class="number">4</span>: <span class="number">8</span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>enumerate</strong></p>
<p><code>enumerate</code> 同时生成可迭代对象中元素的值和索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>S=<span class="string">&quot;spam&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>E=<span class="built_in">enumerate</span>(S)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>E</span><br><span class="line">&lt;<span class="built_in">enumerate</span> <span class="built_in">object</span> at <span class="number">0x104af09d8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(E)</span><br><span class="line">(<span class="number">0</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(E)</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(E)</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>enumerate</code> 函数会返回一个生成器对象，这种对象支持迭代协议。</p>
<h2 id="for-循环遍历shell命令的返回值"><a href="#for-循环遍历shell命令的返回值" class="headerlink" title="for 循环遍历shell命令的返回值"></a>for 循环遍历shell命令的返回值</h2><p>可以用for循环收集shell命令的返回值进行处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>F=os.popen(<span class="string">&#x27;ls -l&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> line <span class="keyword">in</span> F.readlines():</span><br><span class="line"><span class="meta">... </span>    print(line.rstrip())</span><br><span class="line">...</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">drwx------@  <span class="number">3</span> shenshawn  staff    <span class="number">96</span>  <span class="number">7</span> <span class="number">29</span> <span class="number">22</span>:<span class="number">00</span> Applications</span><br><span class="line">drwx------+ <span class="number">11</span> shenshawn  staff   <span class="number">352</span>  <span class="number">9</span>  <span class="number">5</span> <span class="number">11</span>:<span class="number">00</span> Desktop</span><br></pre></td></tr></table></figure>
<h1 id="12、迭代和推导"><a href="#12、迭代和推导" class="headerlink" title="12、迭代和推导"></a>12、迭代和推导</h1><p>“可迭代对象”本质上就是序列观念的一种通用化：如果对象是实际保存的序列或是可以在迭代工具上下文中（例如，for循环）一次产生一个结果的对象，那么就看作是可迭代的。可迭代对象包括实际序列，以及能够按照需求计算的虚拟序列。</p>
<p>可迭代对象（iterable）一般指一个支持iter调用的对象。</p>
<p>迭代器（iterator）指一个支持<code>next(I)</code>调用的对象（这个对象是通过 <code>I = iter(X)</code> 返回的）</p>
<p>生成器指代能自动支持迭代协议的对象，因此生成器本身就是可迭代对象</p>
<h2 id="迭代协议：文件迭代器"><a href="#迭代协议：文件迭代器" class="headerlink" title="迭代协议：文件迭代器"></a>迭代协议：文件迭代器</h2><p>通过不断调用 readline 方法，前进到下一行，到达文件末尾时，会返回空字符串，通过检查空字符串可以跳出循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;tmp.txt&#x27;</span>)</span><br><span class="line">f.readline()</span><br><span class="line">f.readline()</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p>在3.x中，文件有一个名为<code>__next__</code>（2.x中名为<code>next</code>）的，有着与上述几乎一样的效果。每次调用时，返回文件下一行。区别在于，到达文件末尾时，<code>__next__</code>会引发内置的 StopInteration 异常，而不是返回空字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;tmp.txt&#x27;</span>)</span><br><span class="line">f.__next__()</span><br></pre></td></tr></table></figure>
<p><code>__next__</code>这个接口基本上就是Python所谓的迭代协议：所有带有<code>__next__</code>方法的对象会前进到下一个结果，而到达一系列结果的末尾时，<code>__next__</code>会引发 StopInteration 异常，这种对象在Python中被称为迭代器。这类对象也能以for循环或其他迭代工具遍历，因为所有迭代工具内部工作起来都是在每次迭代中调用<code>__next__</code>，并且通过捕捉StopInteration 异常 确认何时离开。</p>
<p>对某些对象完整的迭代协议包括额外的一步 iter调用，但对文件而言这不是必须的。</p>
<blockquote>
<p>注意：2.x中，迭代方法名为  <code>X.next()</code>，3.x中名为 <code>X.__next__()</code>，出于可移植性，出现了 <code>next()</code> 内置函数去调用不同版本的迭代方法。不同版本的迭代原理时一致的</p>
</blockquote>
<h2 id="手动迭代：iter-和-next"><a href="#手动迭代：iter-和-next" class="headerlink" title="手动迭代：iter 和 next"></a>手动迭代：iter 和 next</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000316942.png" alt="image-20210114000316942"></p>
<p>迭代协议涉及了两种对象：</p>
<ul>
<li>可迭代对象：迭代的调用对象，其 <code>__iter__</code> 方法被 iter函数所调用（即，<code>I = iter(X)</code>，X是可迭代对象，I是迭代器对象）</li>
<li>迭代器对象：可迭代对象的返回结果，在迭代过程中实际提供值的对象，它的<code>__next__</code>方法被next 运行，并在结束时触发StopInteration 异常</li>
</ul>
<p>迭代器工具在多数情况下，自动执行这些步骤，以 for 循环为例：for循环在开始时，会首先把可迭代对象传入内置函数iter，并由此拿到一个迭代器；而iter调用返回的迭代器对象有着next方法。iter函数与 next同 <code>__next__</code>的关系类型，其在内部调用了 <code>__iter__</code>方法</p>
<h2 id="内置类型可迭代对象"><a href="#内置类型可迭代对象" class="headerlink" title="内置类型可迭代对象"></a>内置类型可迭代对象</h2><p>除了文件和像列表这样的物理序列外，其他类型也有其适用的迭代器。在最新的Python版本中，字典作为一个可迭代对象自带一个迭代器，在迭代上下文中，会自动一次返回一个键</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>=&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;c&#x27;</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I = <span class="built_in">iter</span>(<span class="built_in">dict</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(I)</span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br></pre></td></tr></table></figure>
<p>shelve（Python对象的一种按照键访问的文件系统）和os.popen 的返回结果也是可迭代的。对于这些可迭代对象，只要我们使用了 被for循环以及其他迭代上下文自动采用的完整迭代协议，也就是顶层的<code>iter()</code>调用，那么<code>iter</code>会执行一些内部必要的步骤，从而使该对象支持<code>next</code>调用。</p>
<p>迭代协议也是我们必须把某些返回结果包装到一个<code>list</code>调用中，才能一次看到它们的值的原因。可迭代对象一次返回一个结果，而不是一次性返回一个实际的列表。</p>
<h2 id="列表推导"><a href="#列表推导" class="headerlink" title="列表推导"></a>列表推导</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列表推导</span></span><br><span class="line">L = [x + <span class="number">10</span> <span class="keyword">for</span> x <span class="keyword">in</span> L]</span><br><span class="line"></span><br><span class="line"><span class="comment">#for循环</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(L)):</span><br><span class="line">  L[i]+=<span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>列表推导并不完全和for循环语句相同，因为<strong>它产生一个新的列表对象</strong>（for 循环是在原基础上修改）。</p>
<p>列表推导看上去像一个反着写的for循环。但列表推导更精简，而且执行速度比for循环更快。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例子</span></span><br><span class="line">[line.upper() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;tmp.txt&#x27;</span>)]</span><br><span class="line">[line.upper() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;tmp.txt&#x27;</span>) <span class="keyword">if</span> line[<span class="number">0</span>] == <span class="string">&#x27;p&#x27;</span>]</span><br><span class="line">[x+y <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">for</span> y <span class="keyword">in</span> <span class="string">&#x27;lmn&#x27;</span>]  <span class="comment">#相当于嵌套循环</span></span><br></pre></td></tr></table></figure>
<h2 id="其他迭代上下文"><a href="#其他迭代上下文" class="headerlink" title="其他迭代上下文"></a>其他迭代上下文</h2><p>用户定义的类也可以实现迭代协议。任何利用了迭代协议的工具，都能在遵循了迭代协议的任何内置类型或用户定义的类上自动工作。</p>
<p>虽然上述例子用的for循环介绍，但 所有能够在对象中 从左到右扫描的内置工具都使用了迭代协议。</p>
<p>Python还包含了其他许多处理可迭代对象的内置函数。</p>
<ul>
<li>map：作用是把一个函数调用应用于传入的可迭代对象的每一项<code>map(str.upper),open(&#39;tmp.txt&#39;)</code></li>
<li>sorted：排序可迭代对象</li>
<li>zip：组合可迭代对象中的项</li>
<li>enumerate：把可迭代对象中的项与它们的位置相匹配</li>
<li>filter：按照一个函数是否为真来选择可迭代对象中的项</li>
<li>reduce：针对可迭代对象中的成对的项来运行一个函数<code>reduce(add, [1, 3, 5, 7, 9]</code>)</li>
</ul>
<p>3.x中，zip、enumerate、filter、map都会返回一个可迭代对象。sorted会返回一个新的排序后的真正列表。</p>
<p>实际上Python内置工具集中所有能够从左到右扫描一个对象的工具，都被定义为在主体对象上使用了迭代协议。这甚至包括了更高级的工具，如list，tuple，字符串join 方法。还有其他的一些工具如：序列赋值、in成员测试、分片赋值、列表的extend方法。还有set调用，集合推导和字典推导式，sum，all，any，max，min</p>
<p>在函数调用中，还有一种特殊的 *arg 形式，它也是迭代上下文。它会把一个集合的值解包为单个的参数</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000328077.png" alt="image-20210114000328077"></p>
<h2 id="Python-3-x-中新增的可迭代对象"><a href="#Python-3-x-中新增的可迭代对象" class="headerlink" title="Python 3.x 中新增的可迭代对象"></a>Python 3.x 中新增的可迭代对象</h2><p>字典方法Keys，values，items都在3.x中返回可迭代对象。2.x中它们会直接创建列表。</p>
<h2 id="单次迭代与多次迭代"><a href="#单次迭代与多次迭代" class="headerlink" title="单次迭代与多次迭代"></a>单次迭代与多次迭代</h2><p>一些可迭代对象可以通过 iter 函数生成多个不同的迭代器，而一些可迭代对象只能生成一个迭代器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多个不同的迭代器</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I1 = <span class="built_in">iter</span>(L)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I2 = <span class="built_in">iter</span>(L)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(I1)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(I2)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种可迭代对象本身就是迭代器，通过 iter函数调用后，返回的是它们自身</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>M = <span class="built_in">map</span>(<span class="built_in">abs</span>,(-<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I1 = <span class="built_in">iter</span>(M)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I2 = <span class="built_in">iter</span>(M)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I1</span><br><span class="line">&lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x104af8710</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>I2</span><br><span class="line">&lt;<span class="built_in">map</span> <span class="built_in">object</span> at <span class="number">0x104af8710</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(I1)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(I2)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">next</span>(M)</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>range，list，字典的key（<code>I = item(D)</code>）  可以多次迭代</p>
<p>map，filter，reduce，文件对象 只能单次迭代</p>
<h1 id="13、文档"><a href="#13、文档" class="headerlink" title="13、文档"></a>13、文档</h1><h2 id="Python文档资源"><a href="#Python文档资源" class="headerlink" title="Python文档资源"></a>Python文档资源</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000337900.png" alt="image-20210114000337900" style="zoom:50%;" />

<ul>
<li><p><strong>#注释</strong></p>
<p>#注释适用于较小代码的文档（例如，这个表达式的目的）。文档字符串则是较大型功能的文档</p>
</li>
<li><p>dir函数</p>
<p>dir函数可列表显示对象内所有可用属性。如果不向dir内传入参数，则可以列出调用者作用域内的变量。它也能够传入任何有属性的对象，包括被导入的模块、内置函数和数据类型的名字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>()</span><br><span class="line">[<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;D1&#x27;</span>, <span class="string">&#x27;D2&#x27;</span>, <span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__package__&#x27;</span>...]</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>(sys)</span><br><span class="line"><span class="built_in">dir</span>([])</span><br><span class="line"><span class="built_in">dir</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">dir</span>(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤掉下划线开头的属性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dir1</span>(<span class="params">x</span>):</span></span><br><span class="line">  <span class="keyword">return</span> [a <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">dir</span>(x) <span class="keyword">if</span> <span class="keyword">not</span> a.startswith(<span class="string">&#x27;_&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<p>在返回的属性中，我们通常不关心下划线开头的属性，双下划线开头通常意味着与解释器相关，单下划线开头意味着非正式的私有属性的实现。</p>
<p>dir函数常用于提醒，它不告知属性的实际含义</p>
</li>
<li><p>文档字符串<code>__doc__</code></p>
<p>这些注释字符串，放在模块文件、函数以及类语句的顶部，位于任何可执行代码之前（不过，#注释以及UNIX风格的#!可以放在它们前面）。这些字符串被正式地称为文档字符串。Python会自动装载这些文本，使其成为相应对象的<code>__doc__</code>属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tmp</span>:</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> 这是文档字符串</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    这是文档字符串</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Pydoc：help函数</p>
<p>Pydoc是一段Python程序，用于提取文档字符串以及相关的结构信息。有多种方式启动Pydoc，包括命令行脚本选项。两种最主要的PyDoc接口是 内置的help函数同Pydoc基于GUI 和 基于Web的HTML接口。help函数，会启用Pydoc从而为任何Python对象生成简单的文字报告</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="built_in">help</span>(sys)</span><br><span class="line">Help on built-<span class="keyword">in</span> module sys:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    sys</span><br><span class="line"></span><br><span class="line">MODULE REFERENCE</span><br><span class="line">    https://docs.python.org/<span class="number">3.7</span>/library/sys</span><br><span class="line"></span><br><span class="line">    The following documentation <span class="keyword">is</span> automatically generated <span class="keyword">from</span> the Python</span><br><span class="line">    source files.  It may be incomplete, incorrect <span class="keyword">or</span> include features that</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></li>
<li><p>Pydoc：HTML报告</p>
<p>启用浏览器模式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m doc -b</span><br></pre></td></tr></table></figure>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000351792.png" alt="image-20210114000351792"></p>
</li>
<li><p>Sphix</p>
<p>Sphix是一个强大的文本编写工具，用于大型项目</p>
</li>
<li><p>标准手册集</p>
<p>Python标准手册提供了Python语言及其工具集的完整说明<a target="_blank" rel="noopener" href="https://docs.python.org/3/">https://docs.python.org/3/</a></p>
</li>
</ul>
<h2 id="常见代码编写陷阱"><a href="#常见代码编写陷阱" class="headerlink" title="常见代码编写陷阱"></a>常见代码编写陷阱</h2><ul>
<li>复合语句头部末尾的 :</li>
<li>缩进一致，一般可把tab键改为4个空格</li>
<li>使用for循环，而不是while 和 range</li>
<li>注意赋值语句中的可变对象</li>
<li>在原位置修改对象的函数不会返回结果，如 list.append()，list.sort返回的是None</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/09/14/python/Python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C1%EF%BD%9E9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/09/14/python/Python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C1%EF%BD%9E9/" class="post-title-link" itemprop="url">Python学习手册1～9</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-14 18:10:19" itemprop="dateCreated datePublished" datetime="2020-09-14T18:10:19+08:00">2020-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 00:02:11" itemprop="dateModified" datetime="2021-01-14T00:02:11+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1、Python如何运行程序"><a href="#1、Python如何运行程序" class="headerlink" title="1、Python如何运行程序"></a>1、Python如何运行程序</h1><h2 id="Python程序的结构"><a href="#Python程序的结构" class="headerlink" title="Python程序的结构"></a>Python程序的结构</h2><ol>
<li>程序由模块构成</li>
<li>模块包含语句</li>
<li>语句包含表达式</li>
<li>表达式创建并处理对象</li>
</ol>
<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>Python中，每个模块都是一个单独的命名空间。</p>
<p>在Python中，命名空间就是变量（即变量名）的封装。它以一个带有属性的对象的形式出现（想象字节码那里，如何将变量放到对象中的）。每个文件自动成为一个命名空间。</p>
<h2 id="Python程序的执行方式"><a href="#Python程序的执行方式" class="headerlink" title="Python程序的执行方式"></a>Python程序的执行方式</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234300363.png" alt="image-20210113234300363"></p>
<h3 id="字节码编译"><a href="#字节码编译" class="headerlink" title="字节码编译"></a>字节码编译</h3><p>当程序执行时，Python内部（对用户是透明的）会先将源代码（Python代码文件中的语句）编译成字节码的形式。字节码是源代码底层的、与平台无关的表现形式。一条语句可能对应着一组字节码指令。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234638578.png" alt="image-20210113234638578"></p>
<p>有时，我们执行Python程序后会看到 .pyc  后缀的文件，这就是字节码文件。 一般被 import 导入的库菜会生成 .pyc文件。有 .pyc 文件，可以加速程序的运行，但没有也没关系。</p>
<h3 id="Python虚拟机（PVM）"><a href="#Python虚拟机（PVM）" class="headerlink" title="Python虚拟机（PVM）"></a>Python虚拟机（PVM）</h3><p>程序编译成字节码后，会发送给Python虚拟机（Python virtual Machine）上来执行。PVM不是一个独立的程序，它是解释器中的运行引擎。从技术上讲，它是所谓“Python解释器”的最后一步。</p>
<h3 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h3><p>当Python被安装到机器后，它包含了一些最小化的组件：一个解释器和支持的库。当我们执行脚本时，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python xxx.py</span><br></pre></td></tr></table></figure>
<p>实际上命令<code>python</code>就是解释器（一个可执行程序），解释器中，包含了编译和PVM的相关功能。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234737841.png" alt="image-20210113234737841"></p>
<p>一般默认的Python解释器都是Cpython，即用C语言编写的解释器。但也有其他语言编写的解释器，如 JPython，用Java编写的解释器。</p>
<h3 id="Python执行优化工具"><a href="#Python执行优化工具" class="headerlink" title="Python执行优化工具"></a>Python执行优化工具</h3><p>Python还有一些优化工具，使计算机可以更快的速度运行Python代码。如</p>
<ul>
<li>Psyco实时编译器</li>
<li>Shedskin C++ 转换器</li>
</ul>
<p>它们是执行模块的变体。</p>
<h3 id="冻结二进制文件"><a href="#冻结二进制文件" class="headerlink" title="冻结二进制文件"></a>冻结二进制文件</h3><p>通过从网络上获得的一些第三方工具，可将Python程序转化为可执行程序（即冻结二进制文件，Frozen Binary）。</p>
<p>冻结二进制文件能够将程序的字节码，PVM（解释器）以及任何程序所需要的Python支持文件捆绑在一起形成一个单独的文件包。实际的执行结果将会是一个单独的可执行二进制文件程序。</p>
<p>冻结二进制文件中嵌入了Python，接收端并不需要安装Python以运行二进制文件</p>
<p>生成冻结二进制文件的工具有：</p>
<ul>
<li>py2exe</li>
<li>pyInstaller</li>
<li>freeze</li>
</ul>
<h1 id="2、介绍Python对象类型"><a href="#2、介绍Python对象类型" class="headerlink" title="2、介绍Python对象类型"></a>2、介绍Python对象类型</h1><h2 id="核心类型"><a href="#核心类型" class="headerlink" title="核心类型"></a>核心类型</h2><p>数字、字符串、列表、字典、元组、文件、集合一般被认为是核心对象（数据）类型。 类型、None和布尔型有时也被归为这一分类中。它们被认作是“核心”类型是因为它们是Python语言自身的一部分，并且总是有效的。</p>
<h3 id="序列是什么意思"><a href="#序列是什么意思" class="headerlink" title="序列是什么意思"></a>序列是什么意思</h3><p>一个“序列”是具有位置顺序的对象的集合体。字符串、列表、元组是Python中所有的序列。它们共同拥有一般的序列操作，例如索引、合并和分片，但又各自有自己的类型特定的方法调用。“可迭代性”，意味着任何一个能够按需提供它的内容的物理或虚拟队列。</p>
<h2 id="递归和迭代的区别"><a href="#递归和迭代的区别" class="headerlink" title="递归和迭代的区别"></a>递归和迭代的区别</h2><p>递归和迭代都重复执行指令集。递归是指函数中的语句重复调用自身。迭代是指循环重复执行，直到控制条件变为false。递归和迭代的主要区别在于，递归是一个过程，总是应用于函数，迭代应用于我们希望重复执行的指令集。</p>
<p><strong>递归</strong></p>
<ul>
<li>递归使用选择结构。 </li>
<li>如果递归步骤不能以某种条件（base case）收敛的方式减少问题，则会发生无限递归，并且无限递归可能会使系统崩溃。 </li>
<li>当识别到base case时，递归终止。 </li>
<li>由于维护堆栈的开销，递归通常比迭代慢。 </li>
<li>递归比迭代使用更多的内存。 </li>
<li>递归使代码更小</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class RecursionExample &#123;</span><br><span class="line">   public static void main(String args[]) &#123;</span><br><span class="line">      RecursionExample re = new RecursionExample();</span><br><span class="line">      <span class="built_in">int</span> result = re.factorial(<span class="number">4</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;Result:&quot;</span> + result);</span><br><span class="line">   &#125;</span><br><span class="line">   public <span class="built_in">int</span> factorial(<span class="built_in">int</span> n) &#123;</span><br><span class="line">      <span class="keyword">if</span> (n==<span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> n*factorial(n-<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>迭代</strong></p>
<ul>
<li>迭代使用重复结构。 </li>
<li>如果循环条件测试从未变为假，并且无限循环重复使用CPU周期，则在迭代过程中会发生无限循环。 </li>
<li>循环条件失败时迭代终止。 </li>
<li>迭代不使用堆栈，因此它比递归更快。 </li>
<li>迭代消耗更少的内存。 </li>
<li>迭代使代码更长。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class IterationExample &#123;</span><br><span class="line">   public static void main(String args[]) &#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">         System.out.println(i + <span class="string">&quot; &quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3、数值类型"><a href="#3、数值类型" class="headerlink" title="3、数值类型"></a>3、数值类型</h1><p><strong>小数和分数</strong></p>
<p>重要的是知道浮点数在运算时产生的显示异常（因为硬件本身精度的原因导致）</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234907384.png" alt="image-20210113234907384"></p>
<p>通过使用小数和分数，可使结果显示的更为精确</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234919158.png" alt="image-20210113234919158"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113234939840.png" alt="image-20210113234939840"></p>
<p><strong>集合</strong></p>
<p>集合是不可变对象，因此集合中只能嵌套元组。集合在比较两个数字列表是否一致时很有用，其省去了逐个数字排序比较的开销。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235019327.png" alt="image-20210113235019327"></p>
<p><strong>布尔型（bool）</strong></p>
<p>bool实际上是内置整数类型<code>int</code>的子类（从面向对象的角度看）。True和False的行为与整数1和0是一样的，只不过它们有独特的显示逻辑：它们是作为关键字True和False显示的，而不是数字1和0。bool为这两个对象重新定义了str和repr的字符串格式。</p>
<h1 id="4、动态类型"><a href="#4、动态类型" class="headerlink" title="4、动态类型"></a>4、动态类型</h1><h2 id="变量、对象和引用"><a href="#变量、对象和引用" class="headerlink" title="变量、对象和引用"></a>变量、对象和引用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; 3</span><br></pre></td></tr></table></figure>
<p>上述赋值有在Python中有三步操作：</p>
<ol>
<li>创建一个对象在代表值3</li>
<li>创建一个变量a，如果它还没有被创建的话</li>
<li>将变量与新的对象3相连接</li>
</ol>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235034131.png" alt="image-20210113235034131"></p>
<p>变量仅仅是个名字，类型的概念存在于对象而不是变量名中。变量是通用的，它只是在一个特定的时间点，简单地引用了一个特定的对象而已。</p>
<p>当变量出现在表达式中时，它会马上被当前引用的对象所代替，无论这个对象是什么类型。</p>
<p>根据上图，具体来讲：</p>
<ul>
<li>变量是一个系统表的入口，包含了指向对象的连接</li>
<li>对象是被分配到的一块内存，有足够的空间去表示它们所代表的值</li>
<li>引用是自动形成的从变量到对象的指针</li>
</ul>
<p>每通过表达式创建生成一个新的值，Python都创建了一个新的对象（一块内存）表示这个值，从内部看，作为一种优化手段，Python缓存了一些不可变的对象并对其进行复用（比如较小的整数，0，1等）</p>
<h2 id="对象如何标识类型"><a href="#对象如何标识类型" class="headerlink" title="对象如何标识类型"></a>对象如何标识类型</h2><p>从技术上将，对象不仅有足够的空间表示它的值，还包含了更复杂的结构。每一个对象有两个标准的头部信息：类型标识符（type designator）标识这个对象的类型；引用的技术器（reference counter）决定何时回收这个对象。</p>
<p>如上述的 <code>a=3</code>。整数对象3，包含了值3 以及一个标识符，标识符是一个指向int对象的指针。</p>
<p>因为a引用了3，此时对象3的至少有1个引用。当一个对象的引用为0时，该对象的内存空间会被放入可分配内存池中，这就是Python的垃圾自动回收。</p>
<h2 id="共享引用"><a href="#共享引用" class="headerlink" title="共享引用"></a>共享引用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;3</span><br><span class="line">b&#x3D;a</span><br></pre></td></tr></table></figure>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235044705.png" alt="image-20210113235044705"></p>
<p>上述代码是共享引用。共享引用的关键点在于，如果共享引用了可变类型对象，那么需要注意修改该对象时，对其他引用也会产生影响。</p>
<p>当想让两个变量，拥有相同的列表值时，可以通过：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#共享引用</span></span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=a</span><br><span class="line"></span><br><span class="line"><span class="comment">#为b生成新的内存区域</span></span><br><span class="line">b=a[:]</span><br><span class="line">b=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=copy.copy(a)</span><br><span class="line">b=copy.deepcopy(a)</span><br></pre></td></tr></table></figure>
<p>浅拷贝：嵌套的列表使用同一个引用</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235057829.png" alt="image-20210113235057829"></p>
<p>深拷贝：嵌套的列表使用不同的引用</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235105828.png" alt="image-20210113235105828"></p>
<h2 id="共享引用和相等"><a href="#共享引用和相等" class="headerlink" title="共享引用和相等"></a>共享引用和相等</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a&#x3D;[1,2,3]</span><br><span class="line">b&#x3D;a</span><br><span class="line">c&#x3D;[1,2,3]</span><br></pre></td></tr></table></figure>
<p><code>a==b</code>，<code>a==c</code>，返回的是<code>True</code>。==代表的是值的比较</p>
<p><code>a is b</code> 返回 <code>True</code>，但是<code>a is c</code> 返回<code>False</code>，因为is 判断的是两个变量的引用指针是否是同一个</p>
<p>如果想查询一个对象的引用次数，可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.getrefcount(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h2><p>弱引用不会增加对象的引用数量。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235118434.png" alt="image-20210113235118434"></p>
<h1 id="5、字符串基础"><a href="#5、字符串基础" class="headerlink" title="5、字符串基础"></a>5、字符串基础</h1><blockquote>
<p>首先记住两句话：</p>
<p><strong>1.将字符转换为字节的方式称为编码</strong></p>
<p><strong>2.将字节转换为字符的方式称为解码</strong></p>
</blockquote>
<p>Python字符串，是一个有序的字符集合。</p>
<p>Python分别使用字符串类型对象和文件接口，用来区分文本和二进制数据。对此Python不同版本的支持为：</p>
<ul>
<li><strong>Python 3.x中</strong>：有三种字符类型：str用于Unicode文本（包括ASCII），bytes用于二进制数据（包括已编码的文本），bytearray是bytes的一个可修改的变体。文件在两种模式下工作：文本，它将内容表示为str类型并实现Unicode编码；二进制，它以原始bytes的形式处理，且不做任何数据转换。</li>
<li><strong>Python 2.x中</strong>：unicode字符串表示Unicode文本，str字符串同时处理8位文本和二进制数据，而bytearray从3.X 向后移植，在Python2.6和随后版本可用。普通文件的内容是有str直接表示的字节，但是codes模块打开Unicode文本文件，处理编码，并将内容作为Unicode对象显示。</li>
</ul>
<h2 id="字符串基础"><a href="#字符串基础" class="headerlink" title="字符串基础"></a>字符串基础</h2><p>字符串可以用来表示能够编码为文本或字节的任何事物。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235131085.png" alt="image-20210113235131085"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235141921.png" alt="image-20210113235141921"></p>
<p>几个要点：</p>
<ul>
<li><p>单引号和双引号字符串是一样的</p>
</li>
<li><p>转义序列代表特殊字符</p>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235450728.png" alt="image-20210113235450728" style="zoom:50%;" />

<ul>
<li>str() 的输出追求可读性，输出格式要便于理解，适合用于输出内容到用户终端。</li>
<li>repr() 的输出追求明确性，显示直接的字节内容，适合开发和调试阶段使用。</li>
</ul>
</li>
<li><p>在Unicode世界中，“字节“没有任何含义。Unicode中的单个字符不一定直接映射为单个字节</p>
</li>
<li><p>三引号 可用于 代码中注释代码</p>
</li>
<li><p>索引和分片</p>
</li>
</ul>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235504463.png" alt="image-20210113235504463" style="zoom:50%;" />

<h2 id="字符传表达"><a href="#字符传表达" class="headerlink" title="字符传表达"></a>字符传表达</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235532041.png" alt="image-20210113235532041"></p>
<h3 id="字符传格式化表达式"><a href="#字符传格式化表达式" class="headerlink" title="字符传格式化表达式"></a><strong>字符传格式化表达式</strong></h3><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235539594.png" alt="image-20210113235539594" style="zoom:50%;" />

<p>表达式左侧的转换目标支持多种转换操作，转换目标的结构为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[(keyname)[flags][width][.precision]]typecode</span><br></pre></td></tr></table></figure>
<ul>
<li>keyname：为索引在表达式右侧使用的字典提供键名称</li>
<li>flags：罗列出说明格式的标签，如左对齐（-），数值符号（+），正数前的空白以及负数前的 -（空格）和零填充（0）</li>
<li>width：未被替换的文本给出总的最小字段宽度</li>
<li>.precision：为浮点数设置小数点精度</li>
</ul>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235555985.png" alt="image-20210113235555985" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235602897.png" alt="image-20210113235602897" style="zoom:50%;" />

<h3 id="字符传格式化方法"><a href="#字符传格式化方法" class="headerlink" title="字符传格式化方法"></a><strong>字符传格式化方法</strong></h3><p><img src="Python%E5%AD%A6%E4%B9%A0%E6%89%8B%E5%86%8C1%EF%BD%9E9/image-20210113235622483.png" alt="image-20210113235622483"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235637394.png" alt="image-20210113235637394"></p>
<p>![image-20200916135139164](/Users/shenshawn/Library/Application Support/typora-user-images/image-20200916135139164.png)</p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200916135156467.png" alt="image-20200916135156467" style="zoom:50%;" />

<h1 id="6、列表与字典"><a href="#6、列表与字典" class="headerlink" title="6、列表与字典"></a>6、列表与字典</h1><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>Python列表是：</p>
<ul>
<li>任意对象的有序集合</li>
<li>通过偏移访问</li>
<li>可变长度、异构以及任意嵌套</li>
<li>属于“可变序列”的分类</li>
<li>对象引用数组：从技术上讲，Python列表包含了零个或多个其他对象的引用</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235651021.png" alt="image-20210113235651021"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235658870.png" alt="image-20210113235658870"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">L=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#分片赋值，删除分片的值，并将右侧的值插入其中</span></span><br><span class="line">L[<span class="number">1</span>:<span class="number">2</span>]=[<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">[<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>]</span><br><span class="line">L[<span class="number">1</span>:<span class="number">2</span>]=[]  <span class="comment">#空白列表会删除 分片的值</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">L[<span class="number">1</span>]=[]    <span class="comment">#指定索引则会替换</span></span><br><span class="line">[<span class="number">1</span>,[],<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>除了<code>L.sort()</code>还可以用<code>sotred()</code>排序</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235708783.png" alt="image-20210113235708783"></p>
<p>列表定义好后，只能通过append，extend新增元素</p>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>字典是：</p>
<ul>
<li>通过键而不是偏移量来读取</li>
<li>任意对象的无序集合</li>
<li>长度可变，异构，任意嵌套</li>
<li>属于“可变映射“类型：key是不可变类型，但value是可变类型</li>
<li>对象引用表（散列表）：本质上，字典是作为散列表实现的</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235734469.png" alt="image-20210113235734469"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235740687.png" alt="image-20210113235740687"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>K=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>V=[a,b,c]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>(<span class="built_in">zip</span>(K,V))</span><br><span class="line">&#123;<span class="number">1</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;b&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dict</span>.fromkeys([<span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;y&#x27;</span>],<span class="number">0</span>)</span><br><span class="line">&#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;x&#x27;</span>: <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.x和2.7的区别：</strong></p>
<ul>
<li>D.keys() ，D.values() , D.items()，3.x返回类似集合的可迭代视图，2.7返回的是列表</li>
<li>3.x不再有D.has_key 方法，只有使用 in 成员关系测试</li>
<li>3.x对D.keys()排序时，需要使用 list(D.keys()).sort()</li>
</ul>
<h1 id="7、元组、文件与其他核心类型"><a href="#7、元组、文件与其他核心类型" class="headerlink" title="7、元组、文件与其他核心类型"></a>7、元组、文件与其他核心类型</h1><h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><p>元组是：</p>
<ul>
<li>任意对象的有序集合</li>
<li>通过偏移量存取</li>
<li>属于“不可变序列”：但内嵌的List是可变的</li>
<li>固定长度、多样性、任意嵌套</li>
<li>对象引用的数组：与列表相似，元组应当被看作对象引用的数组</li>
</ul>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235752094.png" alt="image-20210113235752094"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235759078.png" alt="image-20210113235759078"></p>
<p>1、为什了有了列表还要元组？</p>
<p>列表是一种随时间改变的数据结构。而元组的不可变性提供了某种一致性。元组和其他不可变对象的角色类似于其他语言中的“常量”声明，只是这种常量概念在Python中是与对象相结合的，而不是变量</p>
<p>2、命名元组</p>
<p>namedtuple  实现了一个增加了逻辑的元组扩展类型，能同时支持使用序号和属性名访问组件，也可被转换成使用键的类字典形式的访问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rec = namedtuple(<span class="string">&#x27;Rec&#x27;</span>,[<span class="string">&#x27;names&#x27;</span>,<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;jobs&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bob = Rec(<span class="string">&#x27;bob&#x27;</span>,age=<span class="string">&#x27;40.5&#x27;</span>,jobs=[<span class="string">&#x27;dev&#x27;</span>,<span class="string">&#x27;mgr&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bob</span><br><span class="line">Rec(names=<span class="string">&#x27;bob&#x27;</span>, age=<span class="string">&#x27;40.5&#x27;</span>, jobs=[<span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;mgr&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换成一个类字典的基于键的形式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>O = bob._asdict()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>O[<span class="string">&#x27;names&#x27;</span>],O[<span class="string">&#x27;jobs&#x27;</span>]</span><br><span class="line">(<span class="string">&#x27;bob&#x27;</span>, [<span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;mgr&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>O</span><br><span class="line">OrderedDict([(<span class="string">&#x27;names&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>), (<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;40.5&#x27;</span>), (<span class="string">&#x27;jobs&#x27;</span>, [<span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;mgr&#x27;</span>])])</span><br></pre></td></tr></table></figure>
<p>命名元组是一个元组、类、字典的混合体。为了获得额外的功能，需要额外的代码和一些性能上的损失来实现这种魔法。</p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p>内置函数open 能够返回一个Python 文件对象作为到计算机上一个文件的链接。在调用open 后，可以通过返回的文件对象的方法，在程序与相应文件之间来回传递串形式的数据。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235812591.png" alt="image-20210113235812591"></p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235820429.png" alt="image-20210113235820429"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">afile = <span class="built_in">open</span>(filename, mode, option)</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">f = <span class="built_in">open</span>(file=’/sxr/test.txt’ ,mode=’r’ , encoding=’utf-<span class="number">8</span>’)</span><br><span class="line">data = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file=’/sxr/test.txt’ ,mode=’r’ , encoding=’utf-<span class="number">8</span>’) <span class="keyword">as</span> f1:</span><br><span class="line">	print(f1.read())</span><br></pre></td></tr></table></figure>
<p><strong>mode一览表</strong></p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>‘r’</td>
<td>open for reading (default)</td>
</tr>
<tr>
<td>‘w’</td>
<td>open for writing, truncating  the file first</td>
</tr>
<tr>
<td>‘a’</td>
<td>open for writing, appending to  the end of the file if it exists</td>
</tr>
<tr>
<td>‘b’</td>
<td>binary mode</td>
</tr>
<tr>
<td>‘t’</td>
<td>text mode (default)</td>
</tr>
<tr>
<td>‘+’</td>
<td>open a disk file for updating  (reading and writing)</td>
</tr>
<tr>
<td>‘U’</td>
<td>universal newline mode (for  backwards compatibility; should not be used in new code)</td>
</tr>
</tbody></table>
<p>文件往硬盘里存的时候，在内存里是字符串的形式，通过编码之后，以字节的方式存在硬盘里的：</p>
<p><strong>字符串(内存） —–&gt; encoding ——&gt; bytes（硬盘）</strong></p>
<p>所以，想让人能看懂，先从硬盘读取，然后解码到内存：</p>
<p><strong>bytes(硬盘） —–&gt;decode ——&gt; 字符串</strong></p>
<p>1、使用文件时的一些注意：</p>
<ul>
<li>文件有一个迭代器，可以在for循环，列表推导式或其他迭代上下文中自动逐行读取文件</li>
<li>从文件读取的数据回到脚本时是一个字符串</li>
<li>文件是被缓冲的以及可定位的。默认情况下，输出文件总是被缓冲的，这意味着写入的文件可能不会立即从内存转移到硬盘——除非关闭该文件，或运行其flush方法</li>
<li>close通常是可选的：回收时自动关闭</li>
</ul>
<h2 id="存储Python对象到文件"><a href="#存储Python对象到文件" class="headerlink" title="存储Python对象到文件"></a>存储Python对象到文件</h2><h3 id="字符转换为对象"><a href="#字符转换为对象" class="headerlink" title="字符转换为对象"></a>字符转换为对象</h3><p>通过eval，可以把字符串转换成对象。eval会执行Python的任何表达式</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235829371.png" alt="image-20210113235829371"></p>
<h3 id="pickle"><a href="#pickle" class="headerlink" title="pickle"></a>pickle</h3><p>pickle可以将对象存储到文件中。但pickle转储的文件，只能在Python中被正确的加载识别</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235836285.png" alt="image-20210113235836285"></p>
<h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><p>json并不想pickle支持种类繁多的Python对象类型，但其格式更为通用。其余法类似于pickle</p>
<h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h3><p>struct能够构造并解析打包二进制数据</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235844182.png" alt="image-20210113235844182"></p>
<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200916210836175.png" alt="image-20200916210836175" style="zoom:50%;" />

<h2 id="其他文件工具"><a href="#其他文件工具" class="headerlink" title="其他文件工具"></a>其他文件工具</h2><p>open函数及其返回的文件对象是Python脚本中通向外部文件的主要接口。除此外，Python工具集中还有其他类似可用的文件工具，例如：</p>
<ul>
<li>标准流：在sys模块中预先打开的文件对象，例如sys.stdout</li>
<li>os模块中的描述文件：文件的整数参数，能够支持如文件锁定之类的较低级工具</li>
<li>套接字、管道、FIFO文件：用于同步进程或者通过网络进行通信的类文件对象</li>
<li>通过键来存取的文件，如shelv模块：通过键直接存储经过pickle模块序列化的不可变python对象</li>
<li>Shell命令流：像os.popen 和 subprocess.Popen这样的工具，支持shell命令处理，并读取写入到标准流</li>
</ul>
<h2 id="核心类型复习"><a href="#核心类型复习" class="headerlink" title="核心类型复习"></a>核心类型复习</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235853720.png" alt="image-20210113235853720"></p>
<ul>
<li>python3 不再支持非数字混合类型的相对大小比较（如 1 &lt; ‘spam’ ）</li>
<li>python3中，dict不再可以直接比较（如 D1 &lt; D2）。要么循环根据键比较值，要么手动比较排序的键/值 列表 <code>sorted(D1.items()) &lt; sotred(D2.items())</code></li>
<li>python中，整数0表示假，整数1表示真。任何空数据结构为假，任何非空数据结构为真</li>
<li>None对象，是个特殊的对象。一般起到一个空占位符的作用。可以将None视为某些内容，只是这些内容对我们来说没有用</li>
</ul>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235902597.png" alt="image-20210113235902597" style="zoom:50%;" />

<h3 id="内置类型陷阱"><a href="#内置类型陷阱" class="headerlink" title="内置类型陷阱"></a>内置类型陷阱</h3><p>注意 <code>Y = [L] *4</code>  , <code>Y = list(L) * 4</code>，这两个list的元素都共享了一个引用。如果想拷贝，应当是 <code>Y = [list(L) for i in range(4)]</code></p>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235916648.png" alt="image-20210113235916648" style="zoom:50%;" />

<h3 id="越界操作与赋值操作"><a href="#越界操作与赋值操作" class="headerlink" title="越界操作与赋值操作"></a>越界操作与赋值操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="comment"># L[4] 会提示越界错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分片越界显示所有元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[-<span class="number">1000</span>:<span class="number">1000</span>]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[-<span class="number">1000</span>:]</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#反向序列赋值，相当于插入了一个元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">2</span>:<span class="number">1</span>] = [<span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#赋值操作</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X=<span class="string">&quot;spam&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Y=<span class="string">&quot;eggs&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X,Y=Y,X   <span class="comment">#这样赋值的话，是引用顺序直接调换。注意其和分开赋值的区别</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X,Y</span><br><span class="line">(<span class="string">&#x27;eggs&#x27;</span>, <span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#	字符索引运算</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X</span><br><span class="line"><span class="string">&#x27;eggs&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;e&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(X)[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;e&#x27;</span></span><br></pre></td></tr></table></figure>
<h1 id="8、Python语句简介"><a href="#8、Python语句简介" class="headerlink" title="8、Python语句简介"></a>8、Python语句简介</h1><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235931591.png" alt="image-20210113235931591" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200917105250030.png" alt="image-20200917105250030" style="zoom:50%;" />

<h1 id="9、赋值、表达式、打印"><a href="#9、赋值、表达式、打印" class="headerlink" title="9、赋值、表达式、打印"></a>9、赋值、表达式、打印</h1><h2 id="赋值语句形式"><a href="#赋值语句形式" class="headerlink" title="赋值语句形式"></a>赋值语句形式</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210113235945014.png" alt="image-20210113235945014" style="zoom:50%;" />

<ul>
<li><p><strong>元组及列表解包赋值</strong></p>
<p>表中第二行和第三行形式是相关的。在赋值时，Python在内部会为右侧的各项创建一个元组，这就是“元组解包赋值的由来”</p>
</li>
<li><p><strong>扩展的序列解包</strong></p>
<p>倒数第3行，在Python 3.x中出现的新的赋值方式。 <code>a 的值为&#39;s&#39;</code> , <code>b 的值为 [&#39;p&#39;, &#39;a&#39;, &#39;m&#39;]</code></p>
</li>
<li><p><strong>多目标赋值</strong></p>
<p>倒数第2行，相当于 <code>ham = &#39;lunch&#39;</code> ， <code>span = ham</code>，两个变量名使用了同一个引用</p>
</li>
<li><p><strong>增量赋值</strong></p>
<p>最后一行是增量赋值。其运行的会比 <code>spams = spams + 42</code> 更快。但需要注意，如果操作主体是可变的且支持这一操作，那么增量赋值会选择原位置更新而不是复制对象 </p>
</li>
</ul>
<h2 id="命名惯例"><a href="#命名惯例" class="headerlink" title="命名惯例"></a>命名惯例</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200918145958769.png" alt="image-20200918145958769" style="zoom:50%;" />

<h2 id="表达式语句和原位置修改"><a href="#表达式语句和原位置修改" class="headerlink" title="表达式语句和原位置修改"></a>表达式语句和原位置修改</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.append(<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = print(L.append(<span class="number">5</span>))</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p><strong>对列表调用 append ， sort ， reverse 这些原位置修改的运算，一定是对列表做原位置的修改，但这些方法在列表修改后不会返回列表，而是返回的None对象</strong>。如果把这类运算的返回结果赋值回原先的变量名，那么只会失去该列表</p>
<h2 id="打印操作"><a href="#打印操作" class="headerlink" title="打印操作"></a>打印操作</h2><p>Python中，print 是一个程序员友好的标准输出流接口</p>
<p>从技术上讲，打印是将一个或多个对象转换成的相应的文本表示，然后发送给标准输出或其他类似文件的流。</p>
<ul>
<li><p><strong>文件对象方法</strong></p>
<p>回忆一下写入文本的文件对象方法。例如 <code>file.write(str)</code>。打印操作是类似的。文件写入方法是把字符串写入到任意的文件中。而print则是默认地把对象写入stdout流，同时加入了一些自动的格式化。与写入文件方法不同，打印操作不需要预先把对象转换为字符串</p>
</li>
<li><p><strong>标准输出流</strong></p>
<p>标准输出流（stdout）是发送一个程序文本输出的默认位置。标准输出流通畅映射到Python程序的启动窗口。由于Python输出流在Python中可以作为内置的sys模块中的stdout文件对象来使用（如，sys.stdout），因此你可以用文件的写入方法调用来模拟print</p>
</li>
</ul>
<p>打印是Python3.x和Python2.x最为明显的差异之一：</p>
<ul>
<li>在Python3.x中，打印是一个内置函数，提供关键字参数来支持特殊的使用模式</li>
<li>在Python2.x中，打印是一条语句，拥有自己的特定语法</li>
</ul>
<h2 id="Python-3-x的print函数"><a href="#Python-3-x的print函数" class="headerlink" title="Python 3.x的print函数"></a>Python 3.x的print函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方括号中的各式都是可选的</span></span><br><span class="line">print([<span class="built_in">object</span>, ...][, sep=<span class="string">&#x27; &#x27;</span>][, end=<span class="string">&#x27;\n&#x27;</span>][, file=sys.stdout][, flush=<span class="literal">False</span>])</span><br></pre></td></tr></table></figure>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000001966.png" alt="image-20210114000001966" style="zoom:50%;" />

<p>待打印对象的文本表示，是通过把该对象传入str内置函数调用而得到的。</p>
<h2 id="Python-2-x的print语句"><a href="#Python-2-x的print语句" class="headerlink" title="Python 2.x的print语句"></a>Python 2.x的print语句</h2><img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200918152445798.png" alt="image-20200918152445798" style="zoom:50%;" />

<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000019521.png" alt="image-20210114000019521" style="zoom:50%;" />

<h2 id="打印流重定向"><a href="#打印流重定向" class="headerlink" title="打印流重定向"></a>打印流重定向</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000036494.png" alt="image-20210114000036494" style="zoom:50%;" />

<p>print 操作只是提供了sys.stdout对象的简单接口，再加上一些默认的格式设置。</p>
<img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000047976.png" alt="image-20210114000047976" style="zoom:50%;" />

<img src="/Users/shenshawn/Library/Application Support/typora-user-images/image-20200918152943250.png" alt="image-20200918152943250" style="zoom:50%;" />

<h2 id="2-x支持3-x的print函数"><a href="#2-x支持3-x的print函数" class="headerlink" title="2.x支持3.x的print函数"></a>2.x支持3.x的print函数</h2><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000100357.png" alt="image-20210114000100357" style="zoom:50%;" />

<h2 id="通用的表达式"><a href="#通用的表达式" class="headerlink" title="通用的表达式"></a>通用的表达式</h2><p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114000116105.png" alt="image-20210114000116105"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/09/03/python/uWSGI%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/09/03/python/uWSGI%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">uWSGI相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-03 02:18:42" itemprop="dateCreated datePublished" datetime="2020-09-03T02:18:42+08:00">2020-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 00:14:23" itemprop="dateModified" datetime="2021-01-14T00:14:23+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhouej/archive/2012/03/25/2379646.html">uWSGI配置文档翻译</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/679dee0a4193">做python Web开发你要理解：WSGI &amp; uwsgi</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://heavyfish.github.io/2020/09/03/python/%E5%85%A8%E5%B1%80%E8%A7%A3%E6%9E%90%E9%94%81%EF%BC%88GIL%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/heavyfish.github.io/images/avatar.gif">
      <meta itemprop="name" content="Shenxr">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="速查笔记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/heavyfish.github.io/2020/09/03/python/%E5%85%A8%E5%B1%80%E8%A7%A3%E6%9E%90%E9%94%81%EF%BC%88GIL%EF%BC%89/" class="post-title-link" itemprop="url">全局解析锁（GIL）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-03 01:47:21" itemprop="dateCreated datePublished" datetime="2020-09-03T01:47:21+08:00">2020-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-14 00:13:41" itemprop="dateModified" datetime="2021-01-14T00:13:41+08:00">2021-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/heavyfish.github.io/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903859815448589">你是否真的了解全局解析锁(GIL)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/75780308">深入理解Python中的GIL（全局解释器锁）</a></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>全局解释器锁（GIL）是一种在计算机语言解释器中使用的机制，用于同步线程的执行，以便一次只能执行一个本机线程。</p>
<p>我们需要明确的一点是GIL并不是Python的特性，它是在实现Python解析器(CPython)时所引入的一个概念。</p>
<p>在CPython中，全局解释器锁（即GIL）是一个<code>mutex</code>，可以防止多个本机线程同时执行Python字节码。Lock是必要的，主要是因为CPython的内存管理不是线程安全的。 （但是，由于存在GIL，因此其他功能也逐渐依赖于它所执行的保证。）</p>
<h1 id="为什么会有GIL"><a href="#为什么会有GIL" class="headerlink" title="为什么会有GIL"></a>为什么会有GIL</h1><p>因为一开始是单核心多任务，所以用GIL锁确保全局变量的一致性。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114001308967.png" alt="image-20210114001308967"></p>
<h2 id="GIL的缺点"><a href="#GIL的缺点" class="headerlink" title="GIL的缺点"></a>GIL的缺点</h2><h2 id="1、无法充分利用多核"><a href="#1、无法充分利用多核" class="headerlink" title="1、无法充分利用多核"></a>1、无法充分利用多核</h2><p>GIL锁是全局的，因此即使你拥有多核心，<strong>但如果线程2需要在CPU 2 上执行，它需要先等待在CPU 1 上执行的线程1释放GIL（记住：GIL是全局的）</strong>。如果线程1是因为 i/o 阻塞让出的GIL，那么线程2必定拿到Gil。但如果线程1是因为timer ticks计数满100让出GIL，那么这个时候线程1和线程2公平竞争。但要命的是，在Python 2.x, 线程1不会动态的调整自身的优先级，所以很大概率下次被选中执行的还是线程1，在很多个这样的选举周期内，线程2只能安静的看着线程1拿着GIL在CPU 1上欢快的执行。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114001323848.png" alt="image-20210114001323848"></p>
<h2 id="2、GIL不意味绝对的线程安全"><a href="#2、GIL不意味绝对的线程安全" class="headerlink" title="2、GIL不意味绝对的线程安全"></a>2、GIL不意味绝对的线程安全</h2><p>G一个线程有两种情况下会释放全局解释器锁，一种情况是在该线程进入IO操作之前，会主动释放GIL，另一种情况是解释器不间断运行了1000字节码（Py2）或运行15毫秒（Py3）后，该线程也会放弃GIL。</p>
<p>GIL虽然从设计的出发点就是考虑到线程安全，但这种线程安全是粗粒度的线程安全，即不需要程序员自己对线程进行加锁处理，但涉及到具体场景时，有时还需要程序员自己加上细粒度的锁（即在代码中编写 <code>mutex</code>）</p>
<p>首先来看第一种线程释放GIL的情况。假设现在线程A因为进入IO操作而主动释放了GIL，那么在这种情况下，由于线程A的IO操作等待时间不确定，那么等待的线程B一定会得到GIL锁，这种比较“礼貌的”情况我们一般称为“协同式多任务处理”，相当于大家按照协商好的规则来，线程是安全的，不需要额外加锁。</p>
<p>接下来，我们来看另外一种情况，即线程A是因为解释器不间断执行了1000字节码的指令或不间断运行了15毫秒而放弃了GIL，那么此时实际上线程A和线程B将同时竞争GIL锁。在同时竞争的情况下，实际上谁会竞争成功是不确定的一个结果，所以一般被称为“抢占式多任务处理”，这种情况下当然就看谁抢得厉害了。当然，在python3上由于对GIL做了优化，并且会动态调整线程的优先级，所以线程B的优先级会比较高，但仍然无法肯定线程B就一定会拿到GIL。那么在这种情况下，线程可能就会出现不安全的状态。针对这种纯计算的操作，我们用一段代码来演示下这种线程不安全的状态。代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line"></span><br><span class="line">n &#x3D; 0</span><br><span class="line"></span><br><span class="line">def add():</span><br><span class="line">global n</span><br><span class="line">for i in range(1000000):</span><br><span class="line">n &#x3D; n + 1</span><br><span class="line"></span><br><span class="line">def sub():</span><br><span class="line">global n</span><br><span class="line">for i in range(1000000):</span><br><span class="line">n &#x3D; n - 1</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">t1 &#x3D; threading.Thread(target&#x3D;add)</span><br><span class="line">t2 &#x3D; threading.Thread(target&#x3D;sub)</span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line"></span><br><span class="line">print(&quot;n的值为:&quot;, n)</span><br></pre></td></tr></table></figure>
<p>上面的代码很简单，分别用线程1和线程2对全局变量n进行了1000000次的加和减操作。如果线程安全的话，那么最终的结果n应该还是为0。但实际上，我们运行之后，会发现这个n的值有时大有时小，完全不确定。这个问题的原因在于，上述代码中 涉及 加法 和 减法 的部分不是原子级的。</p>
<p><img src="https://image-1303893285.cos.ap-shanghai.myqcloud.com/image/image-20210114001335944.png" alt="image-20210114001335944"></p>
<p>不管是加法还是减法运算，都会分为4步完成。以加法为例，第一步是LOAD_GLOBAL(加载全局变量n)，第二步LOAD_CONST(加载常量1)，第三步进行二进制的加法，第四步将计算结果存储到全局变量n中，加法计算结束。这四个指令如果能够保证被作为一个整体完整地运行，那么是不会产生问题的，但根据前面说的线程释放GIL的原则，那么很有可能在线程正在执行这四步中的任何一步的时候释放掉GIL而进入等待状态，这个时候发生的事情就比较有意思了。为了方便大家理解，我拿一种比较极端的情况来说明一下。比如我们在加法运算中，正准备执行第四步的时候，很不幸失去了GIL，进入等待状态（注意此时n值仍然为0）。减法运算的线程开始执行，它加载了全局变量n（值为0），并进行减法相关的计算，它也在执行第三步的时候失去了GIL，此时它进入等待状态，加法运算继续。上一次加法计算继续运行第4步，即把加法运算结果赋值给全局变量n，那么此时n的值为1。同样道理，减法操作拿回GIL时，它之前已经加载了为0的n的值，所以它继续操作到最后赋值那步时，n的值就为0-1=-1。换句话说，n的值要么为1，要么为-1，但我们期望的应该是0。这就造成了线程不安全的情形。最终，经过百万次这样不确定的加减操作，那么结果一定是不确定的。这就是引起这个问题的过程和原因。【<strong>核心点在于 字节码不是原子级的</strong>】</p>
<p>Python有很多操作是原子级的，针对原子级的操作，由于方法本身是<strong>单个字节码</strong>，所以线程没有办法在调用期间放弃GIL。典型的例子比如sort方法。【<strong>非IO操作的多线程是否安全，核心在于字节码是单个还是多个，单个字节码是原子级的，则安全</strong>】</p>
<h1 id="避免GIL的影响"><a href="#避免GIL的影响" class="headerlink" title="避免GIL的影响"></a>避免GIL的影响</h1><ol>
<li>在以IO操作为主的IO密集型应用中，多线程和多进程的性能区别并不大，原因在于即使在Python中有GIL锁的存在，由于线程中的IO操作会使得线程立即释放GIL，切换到其他非IO线程继续操作，提高程序执行效率。相比进程操作，线程操作更加轻量级，线程之间的通讯复杂度更低，建议使用多线程。</li>
<li>如果是计算密集型的应用，尽量使用多进程或者协程来代替多线程。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/heavyfish.github.io/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/heavyfish.github.io/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Shenxr</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/heavyfish.github.io/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shenxr</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/heavyfish.github.io/lib/anime.min.js"></script>
  <script src="/heavyfish.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/heavyfish.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/heavyfish.github.io/js/utils.js"></script>

<script src="/heavyfish.github.io/js/motion.js"></script>


<script src="/heavyfish.github.io/js/schemes/pisces.js"></script>


<script src="/heavyfish.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
